


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > HudFragment</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">mindustry.ui.fragments</a>
</div>

<h1>Coverage Summary for Class: HudFragment (mindustry.ui.fragments)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">HudFragment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/72)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/460)
  </span>
</td>
</tr>
  <tr>
    <td class="name">HudFragment$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HudFragment$1SideBar</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/33)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">HudFragment$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/78)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/505)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package mindustry.ui.fragments;
&nbsp;
&nbsp;import arc.*;
&nbsp;import arc.func.*;
&nbsp;import arc.graphics.*;
&nbsp;import arc.graphics.g2d.*;
&nbsp;import arc.math.*;
&nbsp;import arc.scene.*;
&nbsp;import arc.scene.actions.*;
&nbsp;import arc.scene.event.*;
&nbsp;import arc.scene.style.*;
&nbsp;import arc.scene.ui.*;
&nbsp;import arc.scene.ui.ImageButton.*;
&nbsp;import arc.scene.ui.layout.*;
&nbsp;import arc.struct.*;
&nbsp;import arc.util.*;
&nbsp;import mindustry.annotations.Annotations.*;
&nbsp;import mindustry.content.*;
&nbsp;import mindustry.core.GameState.*;
&nbsp;import mindustry.core.*;
&nbsp;import mindustry.ctype.*;
&nbsp;import mindustry.game.EventType.*;
&nbsp;import mindustry.game.*;
&nbsp;import mindustry.gen.*;
&nbsp;import mindustry.graphics.*;
&nbsp;import mindustry.input.*;
&nbsp;import mindustry.net.Packets.*;
&nbsp;import mindustry.type.*;
&nbsp;import mindustry.ui.*;
&nbsp;import mindustry.world.blocks.storage.*;
&nbsp;import mindustry.world.blocks.storage.CoreBlock.*;
&nbsp;
&nbsp;import static mindustry.Vars.*;
&nbsp;import static mindustry.gen.Tex.*;
&nbsp;
<b class="nc">&nbsp;public class HudFragment{</b>
&nbsp;    private static final float dsize = 65f, pauseHeight = 36f;
&nbsp;
<b class="nc">&nbsp;    public final PlacementFragment blockfrag = new PlacementFragment();</b>
<b class="nc">&nbsp;    public boolean shown = true;</b>
&nbsp;
&nbsp;    private ImageButton flip;
<b class="nc">&nbsp;    private CoreItemsDisplay coreItems = new CoreItemsDisplay();</b>
&nbsp;
<b class="nc">&nbsp;    private String hudText = &quot;&quot;;</b>
&nbsp;    private boolean showHudText;
&nbsp;
&nbsp;    private Table lastUnlockTable;
&nbsp;    private Table lastUnlockLayout;
&nbsp;    private long lastToast;
&nbsp;
&nbsp;    public void build(Group parent){
&nbsp;
&nbsp;        //warn about guardian/boss waves
<b class="nc">&nbsp;        Events.on(WaveEvent.class, e -&gt; {</b>
<b class="nc">&nbsp;            int max = 10;</b>
<b class="nc">&nbsp;            int winWave = state.rules.winWave &gt; 0 ? state.rules.winWave : Integer.MAX_VALUE;</b>
&nbsp;            outer:
<b class="nc">&nbsp;            for(int i = state.wave - 1; i &lt;= Math.min(state.wave + max, winWave - 2); i++){</b>
<b class="nc">&nbsp;                for(SpawnGroup group : state.rules.spawns){</b>
<b class="nc">&nbsp;                    if(group.effect == StatusEffects.boss &amp;&amp; group.getSpawned(i) &gt; 0){</b>
<b class="nc">&nbsp;                        int diff = (i + 2) - state.wave;</b>
&nbsp;
&nbsp;                        //increments at which to warn about incoming guardian
<b class="nc">&nbsp;                        if(diff == 1 || diff == 2 || diff == 5 || diff == 10){</b>
<b class="nc">&nbsp;                            showToast(Icon.warning, group.type.emoji() + &quot; &quot; + Core.bundle.format(&quot;wave.guardianwarn&quot; + (diff == 1 ? &quot;.one&quot; : &quot;&quot;), diff));</b>
&nbsp;                        }
&nbsp;
&nbsp;                        break outer;
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Events.on(SectorCaptureEvent.class, e -&gt; {</b>
<b class="nc">&nbsp;            if(e.sector.isBeingPlayed()){</b>
<b class="nc">&nbsp;                ui.announce(&quot;@sector.capture.current&quot;, 5f);</b>
&nbsp;            }else{
<b class="nc">&nbsp;                showToast(Core.bundle.format(&quot;sector.capture&quot;, e.sector.name()));</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Events.on(SectorLoseEvent.class, e -&gt; {</b>
<b class="nc">&nbsp;            showToast(Icon.warning, Core.bundle.format(&quot;sector.lost&quot;, e.sector.name()));</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Events.on(SectorInvasionEvent.class, e -&gt; {</b>
<b class="nc">&nbsp;            showToast(Icon.warning, Core.bundle.format(&quot;sector.attacked&quot;, e.sector.name()));</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Events.on(ResetEvent.class, e -&gt; {</b>
<b class="nc">&nbsp;            coreItems.resetUsed();</b>
<b class="nc">&nbsp;            coreItems.clear();</b>
&nbsp;        });
&nbsp;
&nbsp;        //paused table
<b class="nc">&nbsp;        parent.fill(t -&gt; {</b>
<b class="nc">&nbsp;            t.name = &quot;paused&quot;;</b>
<b class="nc">&nbsp;            t.top().visible(() -&gt; state.isPaused() &amp;&amp; shown &amp;&amp; !netServer.isWaitingForPlayers()).touchable = Touchable.disabled;</b>
<b class="nc">&nbsp;            t.table(Styles.black6, top -&gt; top.label(() -&gt; state.gameOver &amp;&amp; state.isCampaign() ? &quot;@sector.curlost&quot; : &quot;@paused&quot;)</b>
<b class="nc">&nbsp;                .style(Styles.outlineLabel).pad(8f)).height(pauseHeight).growX();</b>
&nbsp;            //.padLeft(dsize * 5 + 4f) to prevent alpha overlap on left
&nbsp;        });
&nbsp;
&nbsp;        //&quot;waiting for players&quot;
<b class="nc">&nbsp;        parent.fill(t -&gt; {</b>
<b class="nc">&nbsp;            t.name = &quot;waiting&quot;;</b>
<b class="nc">&nbsp;            t.visible(() -&gt; netServer.isWaitingForPlayers() &amp;&amp; state.isPaused() &amp;&amp; shown).touchable = Touchable.disabled;</b>
<b class="nc">&nbsp;            t.table(Styles.black6, top -&gt; top.add(&quot;@waiting.players&quot;).style(Styles.outlineLabel).pad(18f));</b>
&nbsp;        });
&nbsp;
&nbsp;        //minimap + position
<b class="nc">&nbsp;        parent.fill(t -&gt; {</b>
<b class="nc">&nbsp;            t.name = &quot;minimap/position&quot;;</b>
<b class="nc">&nbsp;            t.visible(() -&gt; Core.settings.getBool(&quot;minimap&quot;) &amp;&amp; shown);</b>
&nbsp;            //minimap
<b class="nc">&nbsp;            t.add(new Minimap()).name(&quot;minimap&quot;);</b>
<b class="nc">&nbsp;            t.row();</b>
&nbsp;            //position
<b class="nc">&nbsp;            t.label(() -&gt;</b>
<b class="nc">&nbsp;                (Core.settings.getBool(&quot;position&quot;) ? player.tileX() + &quot;,&quot; + player.tileY() + &quot;\n&quot; : &quot;&quot;) +</b>
<b class="nc">&nbsp;                (Core.settings.getBool(&quot;mouseposition&quot;) ? &quot;[lightgray]&quot; + World.toTile(Core.input.mouseWorldX()) + &quot;,&quot; + World.toTile(Core.input.mouseWorldY()) : &quot;&quot;))</b>
<b class="nc">&nbsp;            .visible(() -&gt; Core.settings.getBool(&quot;position&quot;) || Core.settings.getBool(&quot;mouseposition&quot;))</b>
<b class="nc">&nbsp;            .touchable(Touchable.disabled)</b>
<b class="nc">&nbsp;            .style(Styles.outlineLabel)</b>
<b class="nc">&nbsp;            .name(&quot;position&quot;);</b>
<b class="nc">&nbsp;            t.top().right();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        ui.hints.build(parent);</b>
&nbsp;
&nbsp;        //menu at top left
<b class="nc">&nbsp;        parent.fill(cont -&gt; {</b>
<b class="nc">&nbsp;            cont.name = &quot;overlaymarker&quot;;</b>
<b class="nc">&nbsp;            cont.top().left();</b>
&nbsp;
<b class="nc">&nbsp;            if(mobile){</b>
&nbsp;                //for better inset visuals
<b class="nc">&nbsp;                cont.rect((x, y, w, h) -&gt; {</b>
<b class="nc">&nbsp;                    if(Core.scene.marginTop &gt; 0){</b>
<b class="nc">&nbsp;                        Tex.paneRight.draw(x, y, w, Core.scene.marginTop);</b>
&nbsp;                    }
<b class="nc">&nbsp;                }).fillX().row();</b>
&nbsp;
<b class="nc">&nbsp;                cont.table(select -&gt; {</b>
<b class="nc">&nbsp;                    select.name = &quot;mobile buttons&quot;;</b>
<b class="nc">&nbsp;                    select.left();</b>
<b class="nc">&nbsp;                    select.defaults().size(dsize).left();</b>
&nbsp;
<b class="nc">&nbsp;                    ImageButtonStyle style = Styles.cleari;</b>
&nbsp;
<b class="nc">&nbsp;                    select.button(Icon.menu, style, ui.paused::show).name(&quot;menu&quot;);</b>
<b class="nc">&nbsp;                    flip = select.button(Icon.upOpen, style, this::toggleMenus).get();</b>
<b class="nc">&nbsp;                    flip.name = &quot;flip&quot;;</b>
&nbsp;
<b class="nc">&nbsp;                    select.button(Icon.paste, style, ui.schematics::show)</b>
<b class="nc">&nbsp;                    .name(&quot;schematics&quot;);</b>
&nbsp;
<b class="nc">&nbsp;                    select.button(Icon.pause, style, () -&gt; {</b>
<b class="nc">&nbsp;                        if(net.active()){</b>
<b class="nc">&nbsp;                            ui.listfrag.toggle();</b>
&nbsp;                        }else{
<b class="nc">&nbsp;                            state.set(state.isPaused() ? State.playing : State.paused);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }).name(&quot;pause&quot;).update(i -&gt; {</b>
<b class="nc">&nbsp;                        if(net.active()){</b>
<b class="nc">&nbsp;                            i.getStyle().imageUp = Icon.players;</b>
&nbsp;                        }else{
<b class="nc">&nbsp;                            i.setDisabled(false);</b>
<b class="nc">&nbsp;                            i.getStyle().imageUp = state.isPaused() ? Icon.play : Icon.pause;</b>
&nbsp;                        }
&nbsp;                    });
&nbsp;
<b class="nc">&nbsp;                    select.button(Icon.chat, style,() -&gt; {</b>
<b class="nc">&nbsp;                        if(net.active() &amp;&amp; mobile){</b>
<b class="nc">&nbsp;                            if(ui.chatfrag.shown()){</b>
<b class="nc">&nbsp;                                ui.chatfrag.hide();</b>
&nbsp;                            }else{
<b class="nc">&nbsp;                                ui.chatfrag.toggle();</b>
&nbsp;                            }
<b class="nc">&nbsp;                        }else if(state.isCampaign()){</b>
<b class="nc">&nbsp;                            ui.research.show();</b>
&nbsp;                        }else{
<b class="nc">&nbsp;                            ui.database.show();</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }).name(&quot;chat&quot;).update(i -&gt; {</b>
<b class="nc">&nbsp;                        if(net.active() &amp;&amp; mobile){</b>
<b class="nc">&nbsp;                            i.getStyle().imageUp = Icon.chat;</b>
<b class="nc">&nbsp;                        }else if(state.isCampaign()){</b>
<b class="nc">&nbsp;                            i.getStyle().imageUp = Icon.tree;</b>
&nbsp;                        }else{
<b class="nc">&nbsp;                            i.getStyle().imageUp = Icon.book;</b>
&nbsp;                        }
&nbsp;                    });
&nbsp;
<b class="nc">&nbsp;                    select.image().color(Pal.gray).width(4f).fillY();</b>
&nbsp;                });
&nbsp;
<b class="nc">&nbsp;                cont.row();</b>
<b class="nc">&nbsp;                cont.image().height(4f).color(Pal.gray).fillX();</b>
<b class="nc">&nbsp;                cont.row();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            cont.update(() -&gt; {</b>
<b class="nc">&nbsp;                if(Core.input.keyTap(Binding.toggle_menus) &amp;&amp; !ui.chatfrag.shown() &amp;&amp; !Core.scene.hasDialog() &amp;&amp; !Core.scene.hasField()){</b>
<b class="nc">&nbsp;                    Core.settings.getBoolOnce(&quot;ui-hidden&quot;, () -&gt; {</b>
<b class="nc">&nbsp;                        ui.announce(Core.bundle.format(&quot;showui&quot;,  Core.keybinds.get(Binding.toggle_menus).key.toString(), 11));</b>
&nbsp;                    });
<b class="nc">&nbsp;                    toggleMenus();</b>
&nbsp;                }
&nbsp;            });
&nbsp;
&nbsp;            Table wavesMain, editorMain;
&nbsp;
<b class="nc">&nbsp;            cont.stack(wavesMain = new Table(), editorMain = new Table()).height(wavesMain.getPrefHeight())</b>
<b class="nc">&nbsp;            .name(&quot;waves/editor&quot;);</b>
&nbsp;
<b class="nc">&nbsp;            wavesMain.visible(() -&gt; shown &amp;&amp; !state.isEditor());</b>
<b class="nc">&nbsp;            wavesMain.top().left().name = &quot;waves&quot;;</b>
&nbsp;
<b class="nc">&nbsp;            wavesMain.table(s -&gt; {</b>
&nbsp;                //wave info button with text
<b class="nc">&nbsp;                s.add(makeStatusTable()).grow().name(&quot;status&quot;);</b>
&nbsp;
<b class="nc">&nbsp;                var rightStyle = new ImageButtonStyle(){{</b>
<b class="nc">&nbsp;                    over = buttonRightOver;</b>
<b class="nc">&nbsp;                    down = buttonRightDown;</b>
<b class="nc">&nbsp;                    up = buttonRight;</b>
<b class="nc">&nbsp;                    disabled = buttonRightDisabled;</b>
<b class="nc">&nbsp;                    imageDisabledColor = Color.clear;</b>
<b class="nc">&nbsp;                    imageUpColor = Color.white;</b>
&nbsp;                }};
&nbsp;
&nbsp;                //table with button to skip wave
<b class="nc">&nbsp;                s.button(Icon.play, rightStyle, 30f, () -&gt; {</b>
<b class="nc">&nbsp;                    if(net.client() &amp;&amp; player.admin){</b>
<b class="nc">&nbsp;                        Call.adminRequest(player, AdminAction.wave, null);</b>
&nbsp;                    }else{
<b class="nc">&nbsp;                        logic.skipWave();</b>
&nbsp;                    }
<b class="nc">&nbsp;                }).growY().fillX().right().width(40f).disabled(b -&gt; !canSkipWave()).name(&quot;skip&quot;).get().toBack();</b>
<b class="nc">&nbsp;            }).width(dsize * 5 + 4f).name(&quot;statustable&quot;);</b>
&nbsp;
<b class="nc">&nbsp;            wavesMain.row();</b>
&nbsp;
<b class="nc">&nbsp;            addInfoTable(wavesMain.table().width(dsize * 5f + 4f).left().get());</b>
&nbsp;
<b class="nc">&nbsp;            editorMain.name = &quot;editor&quot;;</b>
<b class="nc">&nbsp;            editorMain.table(Tex.buttonEdge4, t -&gt; {</b>
&nbsp;                //t.margin(0f);
<b class="nc">&nbsp;                t.name = &quot;teams&quot;;</b>
<b class="nc">&nbsp;                t.add(&quot;@editor.teams&quot;).growX().left();</b>
<b class="nc">&nbsp;                t.row();</b>
<b class="nc">&nbsp;                t.table(teams -&gt; {</b>
<b class="nc">&nbsp;                    teams.left();</b>
<b class="nc">&nbsp;                    int i = 0;</b>
<b class="nc">&nbsp;                    for(Team team : Team.baseTeams){</b>
<b class="nc">&nbsp;                        ImageButton button = teams.button(Tex.whiteui, Styles.clearNoneTogglei, 40f, () -&gt; Call.setPlayerTeamEditor(player, team))</b>
<b class="nc">&nbsp;                        .size(50f).margin(6f).get();</b>
<b class="nc">&nbsp;                        button.getImageCell().grow();</b>
<b class="nc">&nbsp;                        button.getStyle().imageUpColor = team.color;</b>
<b class="nc">&nbsp;                        button.update(() -&gt; button.setChecked(player.team() == team));</b>
&nbsp;
<b class="nc">&nbsp;                        if(++i % 3 == 0){</b>
<b class="nc">&nbsp;                            teams.row();</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                }).left();</b>
<b class="nc">&nbsp;            }).width(dsize * 5 + 4f);</b>
<b class="nc">&nbsp;            editorMain.visible(() -&gt; shown &amp;&amp; state.isEditor());</b>
&nbsp;
&nbsp;            //fps display
<b class="nc">&nbsp;            cont.table(info -&gt; {</b>
<b class="nc">&nbsp;                info.name = &quot;fps/ping&quot;;</b>
<b class="nc">&nbsp;                info.touchable = Touchable.disabled;</b>
<b class="nc">&nbsp;                info.top().left().margin(4).visible(() -&gt; Core.settings.getBool(&quot;fps&quot;) &amp;&amp; shown);</b>
<b class="nc">&nbsp;                IntFormat fps = new IntFormat(&quot;fps&quot;);</b>
<b class="nc">&nbsp;                IntFormat ping = new IntFormat(&quot;ping&quot;);</b>
<b class="nc">&nbsp;                IntFormat tps = new IntFormat(&quot;tps&quot;);</b>
<b class="nc">&nbsp;                IntFormat mem = new IntFormat(&quot;memory&quot;);</b>
<b class="nc">&nbsp;                IntFormat memnative = new IntFormat(&quot;memory2&quot;);</b>
&nbsp;
<b class="nc">&nbsp;                info.label(() -&gt; fps.get(Core.graphics.getFramesPerSecond())).left().style(Styles.outlineLabel).name(&quot;fps&quot;);</b>
<b class="nc">&nbsp;                info.row();</b>
&nbsp;
<b class="nc">&nbsp;                if(android){</b>
<b class="nc">&nbsp;                    info.label(() -&gt; memnative.get((int)(Core.app.getJavaHeap() / 1024 / 1024), (int)(Core.app.getNativeHeap() / 1024 / 1024))).left().style(Styles.outlineLabel).name(&quot;memory2&quot;);</b>
&nbsp;                }else{
<b class="nc">&nbsp;                    info.label(() -&gt; mem.get((int)(Core.app.getJavaHeap() / 1024 / 1024))).left().style(Styles.outlineLabel).name(&quot;memory&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                info.row();</b>
&nbsp;
<b class="nc">&nbsp;                info.label(() -&gt; ping.get(netClient.getPing())).visible(net::client).left().style(Styles.outlineLabel).name(&quot;ping&quot;).row();</b>
<b class="nc">&nbsp;                info.label(() -&gt; tps.get(state.serverTps == -1 ? 60 : state.serverTps)).visible(net::client).left().style(Styles.outlineLabel).name(&quot;tps&quot;).row();</b>
&nbsp;
<b class="nc">&nbsp;            }).top().left();</b>
&nbsp;        });
&nbsp;
&nbsp;        //core info
<b class="nc">&nbsp;        parent.fill(t -&gt; {</b>
<b class="nc">&nbsp;            t.top();</b>
&nbsp;
<b class="nc">&nbsp;            if(Core.settings.getBool(&quot;macnotch&quot;) ){</b>
<b class="nc">&nbsp;                t.margin(macNotchHeight);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            t.visible(() -&gt; shown);</b>
&nbsp;
<b class="nc">&nbsp;            t.name = &quot;coreinfo&quot;;</b>
&nbsp;
<b class="nc">&nbsp;            t.collapser(v -&gt; v.add().height(pauseHeight), () -&gt; state.isPaused() &amp;&amp; !netServer.isWaitingForPlayers()).row();</b>
&nbsp;
<b class="nc">&nbsp;            t.table(c -&gt; {</b>
&nbsp;                //core items
<b class="nc">&nbsp;                c.top().collapser(coreItems, () -&gt; Core.settings.getBool(&quot;coreitems&quot;) &amp;&amp; !mobile &amp;&amp; shown).fillX().row();</b>
&nbsp;
<b class="nc">&nbsp;                float notifDuration = 240f;</b>
<b class="nc">&nbsp;                float[] coreAttackTime = {0};</b>
&nbsp;
<b class="nc">&nbsp;                Events.run(Trigger.teamCoreDamage, () -&gt; coreAttackTime[0] = notifDuration);</b>
&nbsp;
&nbsp;                //&#39;core is under attack&#39; table
<b class="nc">&nbsp;                c.collapser(top -&gt; top.background(Styles.black6).add(&quot;@coreattack&quot;).pad(8)</b>
<b class="nc">&nbsp;                .update(label -&gt; label.color.set(Color.orange).lerp(Color.scarlet, Mathf.absin(Time.time, 2f, 1f))), true,</b>
&nbsp;                () -&gt; {
<b class="nc">&nbsp;                    if(!shown || state.isPaused()) return false;</b>
<b class="nc">&nbsp;                    if(state.isMenu() || !player.team().data().hasCore()){</b>
<b class="nc">&nbsp;                        coreAttackTime[0] = 0f;</b>
<b class="nc">&nbsp;                        return false;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    return (coreAttackTime[0] -= Time.delta) &gt; 0;</b>
&nbsp;                })
<b class="nc">&nbsp;                .touchable(Touchable.disabled)</b>
<b class="nc">&nbsp;                .fillX().row();</b>
<b class="nc">&nbsp;            }).row();</b>
&nbsp;
<b class="nc">&nbsp;            var bossb = new StringBuilder();</b>
<b class="nc">&nbsp;            var bossText = Core.bundle.get(&quot;guardian&quot;);</b>
<b class="nc">&nbsp;            int maxBosses = 6;</b>
&nbsp;
<b class="nc">&nbsp;            t.table(v -&gt; v.margin(10f)</b>
<b class="nc">&nbsp;            .add(new Bar(() -&gt; {</b>
<b class="nc">&nbsp;                bossb.setLength(0);</b>
<b class="nc">&nbsp;                for(int i = 0; i &lt; Math.min(state.teams.bosses.size, maxBosses); i++){</b>
<b class="nc">&nbsp;                    bossb.append(state.teams.bosses.get(i).type.emoji());</b>
&nbsp;                }
<b class="nc">&nbsp;                if(state.teams.bosses.size &gt; maxBosses){</b>
<b class="nc">&nbsp;                    bossb.append(&quot;[accent]+[]&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                bossb.append(&quot; &quot;);</b>
<b class="nc">&nbsp;                bossb.append(bossText);</b>
<b class="nc">&nbsp;                return bossb;</b>
<b class="nc">&nbsp;            }, () -&gt; Pal.health, () -&gt; {</b>
<b class="nc">&nbsp;                if(state.boss() == null) return 0f;</b>
<b class="nc">&nbsp;                float max = 0f, val = 0f;</b>
<b class="nc">&nbsp;                for(var boss : state.teams.bosses){</b>
<b class="nc">&nbsp;                    max += boss.maxHealth;</b>
<b class="nc">&nbsp;                    val += boss.health;</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                return max == 0f ? 0f : val / max;</b>
<b class="nc">&nbsp;            }).blink(Color.white).outline(new Color(0, 0, 0, 0.6f), 7f)).grow())</b>
<b class="nc">&nbsp;            .fillX().width(320f).height(60f).name(&quot;boss&quot;).visible(() -&gt; state.rules.waves &amp;&amp; state.boss() != null &amp;&amp; !(mobile &amp;&amp; Core.graphics.isPortrait())).padTop(7).row();</b>
&nbsp;
<b class="nc">&nbsp;            t.table(Styles.black3, p -&gt; p.margin(4).label(() -&gt; hudText).style(Styles.outlineLabel)).touchable(Touchable.disabled).with(p -&gt; p.visible(() -&gt; {</b>
<b class="nc">&nbsp;                p.color.a = Mathf.lerpDelta(p.color.a, Mathf.num(showHudText), 0.2f);</b>
<b class="nc">&nbsp;                if(state.isMenu()){</b>
<b class="nc">&nbsp;                    p.color.a = 0f;</b>
<b class="nc">&nbsp;                    showHudText = false;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return p.color.a &gt;= 0.001f;</b>
&nbsp;            }));
&nbsp;        });
&nbsp;
&nbsp;        //spawner warning
<b class="nc">&nbsp;        parent.fill(t -&gt; {</b>
<b class="nc">&nbsp;            t.name = &quot;nearpoint&quot;;</b>
<b class="nc">&nbsp;            t.touchable = Touchable.disabled;</b>
<b class="nc">&nbsp;            t.table(Styles.black6, c -&gt; c.add(&quot;@nearpoint&quot;)</b>
<b class="nc">&nbsp;            .update(l -&gt; l.setColor(Tmp.c1.set(Color.white).lerp(Color.scarlet, Mathf.absin(Time.time, 10f, 1f))))</b>
<b class="nc">&nbsp;            .labelAlign(Align.center, Align.center))</b>
<b class="nc">&nbsp;            .margin(6).update(u -&gt; u.color.a = Mathf.lerpDelta(u.color.a, Mathf.num(spawner.playerNear()), 0.1f)).get().color.a = 0f;</b>
&nbsp;        });
&nbsp;
&nbsp;        //&#39;saving&#39; indicator
<b class="nc">&nbsp;        parent.fill(t -&gt; {</b>
<b class="nc">&nbsp;            t.name = &quot;saving&quot;;</b>
<b class="nc">&nbsp;            t.bottom().visible(() -&gt; control.saves.isSaving());</b>
<b class="nc">&nbsp;            t.add(&quot;@saving&quot;).style(Styles.outlineLabel);</b>
&nbsp;        });
&nbsp;
&nbsp;        //TODO DEBUG: rate table
&nbsp;        if(false)
&nbsp;            parent.fill(t -&gt; {
<b class="nc">&nbsp;                t.bottom().left();</b>
<b class="nc">&nbsp;                t.table(Styles.black6, c -&gt; {</b>
<b class="nc">&nbsp;                    Bits used = new Bits(content.items().size);</b>
&nbsp;
<b class="nc">&nbsp;                    Runnable rebuild = () -&gt; {</b>
<b class="nc">&nbsp;                        c.clearChildren();</b>
&nbsp;
<b class="nc">&nbsp;                        for(Item item : content.items()){</b>
<b class="nc">&nbsp;                            if(state.rules.sector != null &amp;&amp; state.rules.sector.info.getExport(item) &gt;= 1){</b>
<b class="nc">&nbsp;                                c.image(item.uiIcon);</b>
<b class="nc">&nbsp;                                c.label(() -&gt; (int)state.rules.sector.info.getExport(item) + &quot; /s&quot;).color(Color.lightGray);</b>
<b class="nc">&nbsp;                                c.row();</b>
&nbsp;                            }
<b class="nc">&nbsp;                        }</b>
&nbsp;                    };
&nbsp;
<b class="nc">&nbsp;                    c.update(() -&gt; {</b>
<b class="nc">&nbsp;                        boolean wrong = false;</b>
<b class="nc">&nbsp;                        for(Item item : content.items()){</b>
<b class="nc">&nbsp;                            boolean has = state.rules.sector != null &amp;&amp; state.rules.sector.info.getExport(item) &gt;= 1;</b>
<b class="nc">&nbsp;                            if(used.get(item.id) != has){</b>
<b class="nc">&nbsp;                                used.set(item.id, has);</b>
<b class="nc">&nbsp;                                wrong = true;</b>
&nbsp;                            }
<b class="nc">&nbsp;                        }</b>
<b class="nc">&nbsp;                        if(wrong){</b>
<b class="nc">&nbsp;                            rebuild.run();</b>
&nbsp;                        }
&nbsp;                    });
<b class="nc">&nbsp;                }).visible(() -&gt; state.isCampaign() &amp;&amp; content.items().contains(i -&gt; state.rules.sector != null &amp;&amp; state.rules.sector.info.getExport(i) &gt; 0));</b>
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;        blockfrag.build(parent);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Remote(targets = Loc.both, forward = true, called = Loc.both)
&nbsp;    public static void setPlayerTeamEditor(Player player, Team team){
<b class="nc">&nbsp;        if(state.isEditor() &amp;&amp; player != null){</b>
<b class="nc">&nbsp;            player.team(team);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void setHudText(String text){
<b class="nc">&nbsp;        showHudText = true;</b>
<b class="nc">&nbsp;        hudText = text;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void toggleHudText(boolean shown){
<b class="nc">&nbsp;        showHudText = shown;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void scheduleToast(Runnable run){
<b class="nc">&nbsp;        long duration = (int)(3.5 * 1000);</b>
<b class="nc">&nbsp;        long since = Time.timeSinceMillis(lastToast);</b>
<b class="nc">&nbsp;        if(since &gt; duration){</b>
<b class="nc">&nbsp;            lastToast = Time.millis();</b>
<b class="nc">&nbsp;            run.run();</b>
&nbsp;        }else{
<b class="nc">&nbsp;            Time.runTask((duration - since) / 1000f * 60f, run);</b>
<b class="nc">&nbsp;            lastToast += duration;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasToast(){
<b class="nc">&nbsp;        return Time.timeSinceMillis(lastToast) &lt; 3.5f * 1000f;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void showToast(String text){
<b class="nc">&nbsp;        showToast(Icon.ok, text);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void showToast(Drawable icon, String text){
<b class="nc">&nbsp;        showToast(icon, -1, text);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void showToast(Drawable icon, float size, String text){
<b class="nc">&nbsp;        if(state.isMenu()) return;</b>
&nbsp;
<b class="nc">&nbsp;        scheduleToast(() -&gt; {</b>
<b class="nc">&nbsp;            Sounds.message.play();</b>
&nbsp;
<b class="nc">&nbsp;            Table table = new Table(Tex.button);</b>
<b class="nc">&nbsp;            table.update(() -&gt; {</b>
<b class="nc">&nbsp;                if(state.isMenu() || !ui.hudfrag.shown){</b>
<b class="nc">&nbsp;                    table.remove();</b>
&nbsp;                }
&nbsp;            });
<b class="nc">&nbsp;            table.margin(12);</b>
<b class="nc">&nbsp;            var cell = table.image(icon).pad(3);</b>
<b class="nc">&nbsp;            if(size &gt; 0) cell.size(size);</b>
<b class="nc">&nbsp;            table.add(text).wrap().width(280f).get().setAlignment(Align.center, Align.center);</b>
<b class="nc">&nbsp;            table.pack();</b>
&nbsp;
&nbsp;            //create container table which will align and move
<b class="nc">&nbsp;            Table container = Core.scene.table();</b>
<b class="nc">&nbsp;            container.top().add(table);</b>
<b class="nc">&nbsp;            container.setTranslation(0, table.getPrefHeight());</b>
<b class="nc">&nbsp;            container.actions(Actions.translateBy(0, -table.getPrefHeight(), 1f, Interp.fade), Actions.delay(2.5f),</b>
&nbsp;            //nesting actions() calls is necessary so the right prefHeight() is used
<b class="nc">&nbsp;            Actions.run(() -&gt; container.actions(Actions.translateBy(0, table.getPrefHeight(), 1f, Interp.fade), Actions.remove())));</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    /** Show unlock notification for a new recipe. */
&nbsp;    public void showUnlock(UnlockableContent content){
&nbsp;        //some content may not have icons... yet
&nbsp;        //also don&#39;t play in the tutorial to prevent confusion
<b class="nc">&nbsp;        if(state.isMenu()) return;</b>
&nbsp;
<b class="nc">&nbsp;        Sounds.message.play();</b>
&nbsp;
&nbsp;        //if there&#39;s currently no unlock notification...
<b class="nc">&nbsp;        if(lastUnlockTable == null){</b>
<b class="nc">&nbsp;            scheduleToast(() -&gt; {</b>
<b class="nc">&nbsp;                Table table = new Table(Tex.button);</b>
<b class="nc">&nbsp;                table.update(() -&gt; {</b>
<b class="nc">&nbsp;                    if(state.isMenu()){</b>
<b class="nc">&nbsp;                        table.remove();</b>
<b class="nc">&nbsp;                        lastUnlockLayout = null;</b>
<b class="nc">&nbsp;                        lastUnlockTable = null;</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;                table.margin(12);</b>
&nbsp;
<b class="nc">&nbsp;                Table in = new Table();</b>
&nbsp;
&nbsp;                //create texture stack for displaying
<b class="nc">&nbsp;                Image image = new Image(content.uiIcon);</b>
<b class="nc">&nbsp;                image.setScaling(Scaling.fit);</b>
&nbsp;
<b class="nc">&nbsp;                in.add(image).size(8 * 6).pad(2);</b>
&nbsp;
&nbsp;                //add to table
<b class="nc">&nbsp;                table.add(in).padRight(8);</b>
<b class="nc">&nbsp;                table.add(&quot;@unlocked&quot;);</b>
<b class="nc">&nbsp;                table.pack();</b>
&nbsp;
&nbsp;                //create container table which will align and move
<b class="nc">&nbsp;                Table container = Core.scene.table();</b>
<b class="nc">&nbsp;                container.top().add(table);</b>
<b class="nc">&nbsp;                container.setTranslation(0, table.getPrefHeight());</b>
<b class="nc">&nbsp;                container.actions(Actions.translateBy(0, -table.getPrefHeight(), 1f, Interp.fade), Actions.delay(2.5f),</b>
&nbsp;                //nesting actions() calls is necessary so the right prefHeight() is used
<b class="nc">&nbsp;                Actions.run(() -&gt; container.actions(Actions.translateBy(0, table.getPrefHeight(), 1f, Interp.fade), Actions.run(() -&gt; {</b>
<b class="nc">&nbsp;                    lastUnlockTable = null;</b>
<b class="nc">&nbsp;                    lastUnlockLayout = null;</b>
<b class="nc">&nbsp;                }), Actions.remove())));</b>
&nbsp;
<b class="nc">&nbsp;                lastUnlockTable = container;</b>
<b class="nc">&nbsp;                lastUnlockLayout = in;</b>
&nbsp;            });
&nbsp;        }else{
&nbsp;            //max column size
<b class="nc">&nbsp;            int col = 3;</b>
&nbsp;            //max amount of elements minus extra &#39;plus&#39;
<b class="nc">&nbsp;            int cap = col * col - 1;</b>
&nbsp;
&nbsp;            //get old elements
<b class="nc">&nbsp;            Seq&lt;Element&gt; elements = new Seq&lt;&gt;(lastUnlockLayout.getChildren());</b>
<b class="nc">&nbsp;            int esize = elements.size;</b>
&nbsp;
&nbsp;            //...if it&#39;s already reached the cap, ignore everything
<b class="nc">&nbsp;            if(esize &gt; cap) return;</b>
&nbsp;
&nbsp;            //get size of each element
<b class="nc">&nbsp;            float size = 48f / Math.min(elements.size + 1, col);</b>
&nbsp;
<b class="nc">&nbsp;            lastUnlockLayout.clearChildren();</b>
<b class="nc">&nbsp;            lastUnlockLayout.defaults().size(size).pad(2);</b>
&nbsp;
<b class="nc">&nbsp;            for(int i = 0; i &lt; esize; i++){</b>
<b class="nc">&nbsp;                lastUnlockLayout.add(elements.get(i));</b>
&nbsp;
<b class="nc">&nbsp;                if(i % col == col - 1){</b>
<b class="nc">&nbsp;                    lastUnlockLayout.row();</b>
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;            //if there&#39;s space, add it
<b class="nc">&nbsp;            if(esize &lt; cap){</b>
&nbsp;
<b class="nc">&nbsp;                Image image = new Image(content.uiIcon);</b>
<b class="nc">&nbsp;                image.setScaling(Scaling.fit);</b>
&nbsp;
<b class="nc">&nbsp;                lastUnlockLayout.add(image);</b>
<b class="nc">&nbsp;            }else{ //else, add a specific icon to denote no more space</b>
<b class="nc">&nbsp;                lastUnlockLayout.image(Icon.add);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            lastUnlockLayout.pack();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /** @deprecated see {@link CoreBuild#beginLaunch(CoreBlock)} */
&nbsp;    @Deprecated
&nbsp;    public void showLaunch(){
<b class="nc">&nbsp;        float margin = 30f;</b>
&nbsp;
<b class="nc">&nbsp;        Image image = new Image();</b>
<b class="nc">&nbsp;        image.color.a = 0f;</b>
<b class="nc">&nbsp;        image.touchable = Touchable.disabled;</b>
<b class="nc">&nbsp;        image.setFillParent(true);</b>
<b class="nc">&nbsp;        image.actions(Actions.delay((coreLandDuration - margin) / 60f), Actions.fadeIn(margin / 60f, Interp.pow2In), Actions.delay(6f / 60f), Actions.remove());</b>
<b class="nc">&nbsp;        image.update(() -&gt; {</b>
<b class="nc">&nbsp;            image.toFront();</b>
<b class="nc">&nbsp;            ui.loadfrag.toFront();</b>
<b class="nc">&nbsp;            if(state.isMenu()){</b>
<b class="nc">&nbsp;                image.remove();</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        Core.scene.add(image);</b>
&nbsp;    }
&nbsp;
&nbsp;    /** @deprecated see {@link CoreBuild#beginLaunch(CoreBlock)} */
&nbsp;    @Deprecated
&nbsp;    public void showLand(){
<b class="nc">&nbsp;        Image image = new Image();</b>
<b class="nc">&nbsp;        image.color.a = 1f;</b>
<b class="nc">&nbsp;        image.touchable = Touchable.disabled;</b>
<b class="nc">&nbsp;        image.setFillParent(true);</b>
<b class="nc">&nbsp;        image.actions(Actions.fadeOut(35f / 60f), Actions.remove());</b>
<b class="nc">&nbsp;        image.update(() -&gt; {</b>
<b class="nc">&nbsp;            image.toFront();</b>
<b class="nc">&nbsp;            ui.loadfrag.toFront();</b>
<b class="nc">&nbsp;            if(state.isMenu()){</b>
<b class="nc">&nbsp;                image.remove();</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        Core.scene.add(image);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void toggleMenus(){
<b class="nc">&nbsp;        if(flip != null){</b>
<b class="nc">&nbsp;            flip.getStyle().imageUp = shown ? Icon.downOpen : Icon.upOpen;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        shown = !shown;</b>
&nbsp;    }
&nbsp;
&nbsp;    private Table makeStatusTable(){
<b class="nc">&nbsp;        Table table = new Table(Tex.wavepane);</b>
&nbsp;
<b class="nc">&nbsp;        StringBuilder ibuild = new StringBuilder();</b>
&nbsp;
&nbsp;        IntFormat
<b class="nc">&nbsp;        wavef = new IntFormat(&quot;wave&quot;),</b>
<b class="nc">&nbsp;        wavefc = new IntFormat(&quot;wave.cap&quot;),</b>
<b class="nc">&nbsp;        enemyf = new IntFormat(&quot;wave.enemy&quot;),</b>
<b class="nc">&nbsp;        enemiesf = new IntFormat(&quot;wave.enemies&quot;),</b>
<b class="nc">&nbsp;        enemycf = new IntFormat(&quot;wave.enemycore&quot;),</b>
<b class="nc">&nbsp;        enemycsf = new IntFormat(&quot;wave.enemycores&quot;),</b>
<b class="nc">&nbsp;        waitingf = new IntFormat(&quot;wave.waiting&quot;, i -&gt; {</b>
<b class="nc">&nbsp;            ibuild.setLength(0);</b>
<b class="nc">&nbsp;            int m = i/60;</b>
<b class="nc">&nbsp;            int s = i % 60;</b>
<b class="nc">&nbsp;            if(m &gt; 0){</b>
<b class="nc">&nbsp;                ibuild.append(m);</b>
<b class="nc">&nbsp;                ibuild.append(&quot;:&quot;);</b>
<b class="nc">&nbsp;                if(s &lt; 10){</b>
<b class="nc">&nbsp;                    ibuild.append(&quot;0&quot;);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            ibuild.append(s);</b>
<b class="nc">&nbsp;            return ibuild.toString();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        table.touchable = Touchable.enabled;</b>
&nbsp;
<b class="nc">&nbsp;        StringBuilder builder = new StringBuilder();</b>
&nbsp;
<b class="nc">&nbsp;        table.name = &quot;waves&quot;;</b>
&nbsp;
<b class="nc">&nbsp;        table.marginTop(0).marginBottom(4).marginLeft(4);</b>
&nbsp;
&nbsp;        class SideBar extends Element{
&nbsp;            public final Floatp amount;
&nbsp;            public final boolean flip;
&nbsp;            public final Boolp flash;
&nbsp;
&nbsp;            float last, blink, value;
&nbsp;
<b class="nc">&nbsp;            public SideBar(Floatp amount, Boolp flash, boolean flip){</b>
<b class="nc">&nbsp;                this.amount = amount;</b>
<b class="nc">&nbsp;                this.flip = flip;</b>
<b class="nc">&nbsp;                this.flash = flash;</b>
&nbsp;
<b class="nc">&nbsp;                setColor(Pal.health);</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void draw(){
<b class="nc">&nbsp;                float next = amount.get();</b>
&nbsp;
<b class="nc">&nbsp;                if(Float.isNaN(next) || Float.isInfinite(next)) next = 1f;</b>
&nbsp;
<b class="nc">&nbsp;                if(next &lt; last &amp;&amp; flash.get()){</b>
<b class="nc">&nbsp;                    blink = 1f;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                blink = Mathf.lerpDelta(blink, 0f, 0.2f);</b>
<b class="nc">&nbsp;                value = Mathf.lerpDelta(value, next, 0.15f);</b>
<b class="nc">&nbsp;                last = next;</b>
&nbsp;
<b class="nc">&nbsp;                if(Float.isNaN(value) || Float.isInfinite(value)) value = 1f;</b>
&nbsp;
<b class="nc">&nbsp;                drawInner(Pal.darkishGray, 1f);</b>
<b class="nc">&nbsp;                drawInner(Tmp.c1.set(color).lerp(Color.white, blink), value);</b>
&nbsp;            }
&nbsp;
&nbsp;            void drawInner(Color color, float fract){
<b class="nc">&nbsp;                if(fract &lt; 0) return;</b>
&nbsp;
<b class="nc">&nbsp;                fract = Mathf.clamp(fract);</b>
<b class="nc">&nbsp;                if(flip){</b>
<b class="nc">&nbsp;                    x += width;</b>
<b class="nc">&nbsp;                    width = -width;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                float stroke = width * 0.35f;</b>
<b class="nc">&nbsp;                float bh = height/2f;</b>
<b class="nc">&nbsp;                Draw.color(color, parentAlpha);</b>
&nbsp;
<b class="nc">&nbsp;                float f1 = Math.min(fract * 2f, 1f), f2 = (fract - 0.5f) * 2f;</b>
&nbsp;
<b class="nc">&nbsp;                float bo = -(1f - f1) * (width - stroke);</b>
&nbsp;
<b class="nc">&nbsp;                Fill.quad(</b>
&nbsp;                x, y,
&nbsp;                x + stroke, y,
&nbsp;                x + width + bo, y + bh * f1,
&nbsp;                x + width - stroke + bo, y + bh * f1
&nbsp;                );
&nbsp;
<b class="nc">&nbsp;                if(f2 &gt; 0){</b>
<b class="nc">&nbsp;                    float bx = x + (width - stroke) * (1f - f2);</b>
<b class="nc">&nbsp;                    Fill.quad(</b>
&nbsp;                    x + width, y + bh,
&nbsp;                    x + width - stroke, y + bh,
&nbsp;                    bx, y + height * fract,
&nbsp;                    bx + stroke, y + height * fract
&nbsp;                    );
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                Draw.reset();</b>
&nbsp;
<b class="nc">&nbsp;                if(flip){</b>
<b class="nc">&nbsp;                    width = -width;</b>
<b class="nc">&nbsp;                    x -= width;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        table.stack(</b>
<b class="nc">&nbsp;        new Element(){</b>
&nbsp;            @Override
&nbsp;            public void draw(){
<b class="nc">&nbsp;                Draw.color(Pal.darkerGray, parentAlpha);</b>
<b class="nc">&nbsp;                Fill.poly(x + width/2f, y + height/2f, 6, height / Mathf.sqrt3);</b>
<b class="nc">&nbsp;                Draw.reset();</b>
<b class="nc">&nbsp;                Drawf.shadow(x + width/2f, y + height/2f, height * 1.13f, parentAlpha);</b>
&nbsp;            }
&nbsp;        },
&nbsp;        new Table(t -&gt; {
<b class="nc">&nbsp;            float bw = 40f;</b>
<b class="nc">&nbsp;            float pad = -20;</b>
<b class="nc">&nbsp;            t.margin(0);</b>
<b class="nc">&nbsp;            t.clicked(() -&gt; {</b>
<b class="nc">&nbsp;                if(!player.dead() &amp;&amp; mobile){</b>
<b class="nc">&nbsp;                    Call.unitClear(player);</b>
<b class="nc">&nbsp;                    control.input.recentRespawnTimer = 1f;</b>
<b class="nc">&nbsp;                    control.input.controlledType = null;</b>
&nbsp;                }
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            t.add(new SideBar(() -&gt; player.dead() ? 0f : player.unit().healthf(), () -&gt; true, true)).width(bw).growY().padRight(pad);</b>
<b class="nc">&nbsp;            t.image(() -&gt; player.icon()).scaling(Scaling.bounded).grow().maxWidth(54f);</b>
<b class="nc">&nbsp;            t.add(new SideBar(() -&gt; player.dead() ? 0f : player.displayAmmo() ? player.unit().ammof() : player.unit().healthf(), () -&gt; !player.displayAmmo(), false)).width(bw).growY().padLeft(pad).update(b -&gt; {</b>
<b class="nc">&nbsp;                b.color.set(player.displayAmmo() ? player.dead() || player.unit() instanceof BlockUnitc ? Pal.ammo : player.unit().type.ammoType.color() : Pal.health);</b>
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            t.getChildren().get(1).toFront();</b>
<b class="nc">&nbsp;        })).size(120f, 80).padRight(4);</b>
&nbsp;
<b class="nc">&nbsp;        Cell[] lcell = {null};</b>
<b class="nc">&nbsp;        boolean[] couldSkip = {true};</b>
&nbsp;
<b class="nc">&nbsp;        lcell[0] = table.labelWrap(() -&gt; {</b>
&nbsp;
&nbsp;            //update padding depend on whether the button to the right is there
<b class="nc">&nbsp;            boolean can = canSkipWave();</b>
<b class="nc">&nbsp;            if(can != couldSkip[0]){</b>
<b class="nc">&nbsp;                if(canSkipWave()){</b>
<b class="nc">&nbsp;                    lcell[0].padRight(8f);</b>
&nbsp;                }else{
<b class="nc">&nbsp;                    lcell[0].padRight(-42f);</b>
&nbsp;                }
<b class="nc">&nbsp;                table.invalidateHierarchy();</b>
<b class="nc">&nbsp;                table.pack();</b>
<b class="nc">&nbsp;                couldSkip[0] = can;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            builder.setLength(0);</b>
&nbsp;
&nbsp;            //mission overrides everything
<b class="nc">&nbsp;            if(state.rules.mission != null &amp;&amp; state.rules.mission.length() &gt; 0){</b>
<b class="nc">&nbsp;                builder.append(state.rules.mission);</b>
<b class="nc">&nbsp;                return builder;</b>
&nbsp;            }
&nbsp;
&nbsp;            //objectives override mission?
<b class="nc">&nbsp;            if(state.rules.objectives.any()){</b>
<b class="nc">&nbsp;                boolean first = true;</b>
<b class="nc">&nbsp;                for(var obj : state.rules.objectives){</b>
<b class="nc">&nbsp;                    if(!obj.qualified() || obj.hidden) continue;</b>
&nbsp;
<b class="nc">&nbsp;                    String text = obj.text();</b>
<b class="nc">&nbsp;                    if(text != null &amp;&amp; !text.isEmpty()){</b>
<b class="nc">&nbsp;                        if(!first) builder.append(&quot;\n[white]&quot;);</b>
<b class="nc">&nbsp;                        builder.append(text);</b>
&nbsp;
<b class="nc">&nbsp;                        first = false;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;
&nbsp;                //TODO: display standard status when empty objective?
<b class="nc">&nbsp;                if(builder.length() &gt; 0){</b>
<b class="nc">&nbsp;                    return builder;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if(!state.rules.waves &amp;&amp; state.rules.attackMode){</b>
<b class="nc">&nbsp;                int sum = Math.max(state.teams.present.sum(t -&gt; t.team != player.team() ? t.cores.size : 0), 1);</b>
<b class="nc">&nbsp;                builder.append(sum &gt; 1 ? enemycsf.get(sum) : enemycf.get(sum));</b>
<b class="nc">&nbsp;                return builder;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if(!state.rules.waves &amp;&amp; state.isCampaign()){</b>
<b class="nc">&nbsp;                builder.append(&quot;[lightgray]&quot;).append(Core.bundle.get(&quot;sector.curcapture&quot;));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if(!state.rules.waves){</b>
<b class="nc">&nbsp;                return builder;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if(state.rules.winWave &gt; 1 &amp;&amp; state.rules.winWave &gt;= state.wave){</b>
<b class="nc">&nbsp;                builder.append(wavefc.get(state.wave, state.rules.winWave));</b>
&nbsp;            }else{
<b class="nc">&nbsp;                builder.append(wavef.get(state.wave));</b>
&nbsp;            }
<b class="nc">&nbsp;            builder.append(&quot;\n&quot;);</b>
&nbsp;
<b class="nc">&nbsp;            if(state.enemies &gt; 0){</b>
<b class="nc">&nbsp;                if(state.enemies == 1){</b>
<b class="nc">&nbsp;                    builder.append(enemyf.get(state.enemies));</b>
&nbsp;                }else{
<b class="nc">&nbsp;                    builder.append(enemiesf.get(state.enemies));</b>
&nbsp;                }
<b class="nc">&nbsp;                builder.append(&quot;\n&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if(state.rules.waveTimer){</b>
<b class="nc">&nbsp;                builder.append((logic.isWaitingWave() ? Core.bundle.get(&quot;wave.waveInProgress&quot;) : (waitingf.get((int)(state.wavetime/60)))));</b>
<b class="nc">&nbsp;            }else if(state.enemies == 0){</b>
<b class="nc">&nbsp;                builder.append(Core.bundle.get(&quot;waiting&quot;));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return builder;</b>
<b class="nc">&nbsp;        }).growX().pad(8f);</b>
&nbsp;
<b class="nc">&nbsp;        table.row();</b>
&nbsp;
&nbsp;        //TODO nobody reads details anyway.
&nbsp;        /*
&nbsp;        table.clicked(() -&gt; {
&nbsp;            if(state.rules.objectives.any()){
&nbsp;                StringBuilder text = new StringBuilder();
&nbsp;
&nbsp;                boolean first = true;
&nbsp;                for(var obj : state.rules.objectives){
&nbsp;                    if(!obj.qualified()) continue;
&nbsp;
&nbsp;                    String details = obj.details();
&nbsp;                    if(details != null){
&nbsp;                        if(!first) text.append(&#39;\n&#39;);
&nbsp;                        text.append(details);
&nbsp;
&nbsp;                        first = false;
&nbsp;                    }
&nbsp;                }
&nbsp;
&nbsp;                //TODO this, as said before, could be much better.
&nbsp;                ui.showInfo(text.toString());
&nbsp;            }
&nbsp;        });*/
&nbsp;
<b class="nc">&nbsp;        return table;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void addInfoTable(Table table){
<b class="nc">&nbsp;        table.name = &quot;infotable&quot;;</b>
<b class="nc">&nbsp;        table.left();</b>
&nbsp;
<b class="nc">&nbsp;        var count = new float[]{-1};</b>
<b class="nc">&nbsp;        table.table().update(t -&gt; {</b>
<b class="nc">&nbsp;            if(player.unit() instanceof Payloadc payload){</b>
<b class="nc">&nbsp;                if(count[0] != payload.payloadUsed()){</b>
<b class="nc">&nbsp;                    payload.contentInfo(t, 8 * 2, 275f);</b>
<b class="nc">&nbsp;                    count[0] = payload.payloadUsed();</b>
&nbsp;                }
&nbsp;            }else{
<b class="nc">&nbsp;                count[0] = -1;</b>
<b class="nc">&nbsp;                t.clear();</b>
&nbsp;            }
<b class="nc">&nbsp;        }).growX().visible(() -&gt; player.unit() instanceof Payloadc p &amp;&amp; p.payloadUsed() &gt; 0).colspan(2);</b>
<b class="nc">&nbsp;        table.row();</b>
&nbsp;
<b class="nc">&nbsp;        Bits statuses = new Bits();</b>
&nbsp;
<b class="nc">&nbsp;        table.table().update(t -&gt; {</b>
<b class="nc">&nbsp;            t.left();</b>
<b class="nc">&nbsp;            Bits applied = player.dead() ? null : player.unit().statusBits();</b>
<b class="nc">&nbsp;            if(!statuses.equals(applied)){</b>
<b class="nc">&nbsp;                t.clear();</b>
&nbsp;
<b class="nc">&nbsp;                if(applied != null){</b>
<b class="nc">&nbsp;                    for(StatusEffect effect : content.statusEffects()){</b>
<b class="nc">&nbsp;                        if(applied.get(effect.id) &amp;&amp; !effect.isHidden()){</b>
<b class="nc">&nbsp;                            t.image(effect.uiIcon).size(iconMed).get()</b>
<b class="nc">&nbsp;                            .addListener(new Tooltip(l -&gt; l.label(() -&gt;</b>
<b class="nc">&nbsp;                                effect.localizedName + &quot; [lightgray]&quot; + UI.formatTime(player.unit().getDuration(effect))).style(Styles.outlineLabel)));</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
&nbsp;
<b class="nc">&nbsp;                    statuses.set(applied);</b>
&nbsp;                }else{
<b class="nc">&nbsp;                    statuses.clear();</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }).left();</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean canSkipWave(){
<b class="nc">&nbsp;        return state.rules.waves &amp;&amp; state.rules.waveSending &amp;&amp; ((net.server() || player.admin) || !net.active()) &amp;&amp; state.enemies == 0 &amp;&amp; !spawner.isSpawning();</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-10-10 14:03</div>
</div>
</body>
</html>
