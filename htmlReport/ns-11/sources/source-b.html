


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > MapObjectivesDialog</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">mindustry.editor</a>
</div>

<h1>Coverage Summary for Class: MapObjectivesDialog (mindustry.editor)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">MapObjectivesDialog</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/93)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/336)
  </span>
</td>
</tr>
  <tr>
    <td class="name">MapObjectivesDialog$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapObjectivesDialog$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapObjectivesDialog$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapObjectivesDialog$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapObjectivesDialog$FieldInterpreter</td>
  </tr>
  <tr>
    <td class="name">MapObjectivesDialog$FieldProvider</td>
  </tr>
  <tr>
    <td class="name">MapObjectivesDialog$TypeInfo</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/29)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/112)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/439)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package mindustry.editor;
&nbsp;
&nbsp;import arc.*;
&nbsp;import arc.func.*;
&nbsp;import arc.graphics.*;
&nbsp;import arc.math.geom.*;
&nbsp;import arc.scene.event.*;
&nbsp;import arc.scene.ui.*;
&nbsp;import arc.scene.ui.TextField.*;
&nbsp;import arc.scene.ui.layout.*;
&nbsp;import arc.struct.*;
&nbsp;import arc.util.*;
&nbsp;import mindustry.content.*;
&nbsp;import mindustry.ctype.*;
&nbsp;import mindustry.game.*;
&nbsp;import mindustry.game.MapObjectives.*;
&nbsp;import mindustry.gen.*;
&nbsp;import mindustry.graphics.*;
&nbsp;import mindustry.io.*;
&nbsp;import mindustry.type.*;
&nbsp;import mindustry.ui.*;
&nbsp;import mindustry.ui.dialogs.*;
&nbsp;import mindustry.world.*;
&nbsp;
&nbsp;import java.lang.annotation.*;
&nbsp;import java.lang.reflect.*;
&nbsp;
&nbsp;import static mindustry.Vars.*;
&nbsp;import static mindustry.editor.MapObjectivesCanvas.*;
&nbsp;
&nbsp;@SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
&nbsp;public class MapObjectivesDialog extends BaseDialog{
&nbsp;    public MapObjectivesCanvas canvas;
<b class="nc">&nbsp;    protected Cons&lt;Seq&lt;MapObjective&gt;&gt; out = arr -&gt; {};</b>
&nbsp;
&nbsp;    /** Defines default value providers. */
<b class="nc">&nbsp;    private static final ObjectMap&lt;Class&lt;?&gt;, FieldProvider&lt;?&gt;&gt; providers = new ObjectMap&lt;&gt;();</b>
&nbsp;    /** Maps annotation type with its field parsers. Non-annotated fields are mapped with {@link Override}. */
<b class="nc">&nbsp;    private static final ObjectMap&lt;Class&lt;? extends Annotation&gt;, ObjectMap&lt;Class&lt;?&gt;, FieldInterpreter&lt;?&gt;&gt;&gt; interpreters = new ObjectMap&lt;&gt;();</b>
&nbsp;
&nbsp;    static{
&nbsp;        // Default un-annotated field interpreters.
<b class="nc">&nbsp;        setProvider(String.class, (type, cons) -&gt; cons.get(&quot;&quot;));</b>
<b class="nc">&nbsp;        setInterpreter(String.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
&nbsp;
<b class="nc">&nbsp;            if(field != null &amp;&amp; field.isAnnotationPresent(Multiline.class)){</b>
<b class="nc">&nbsp;                cont.area(get.get(), set).height(100f).growX();</b>
&nbsp;            }else{
<b class="nc">&nbsp;                cont.field(get.get(), set).growX();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(boolean.class, (type, cons) -&gt; cons.get(false));</b>
<b class="nc">&nbsp;        setInterpreter(boolean.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.check(&quot;&quot;, get.get(), set::get).growX().fillY().get().getLabelCell().growX();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(byte.class, (type, cons) -&gt; cons.get((byte)0));</b>
<b class="nc">&nbsp;        setInterpreter(byte.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.field(Byte.toString(get.get()), str -&gt; set.get((byte)Strings.parseInt(str)))</b>
<b class="nc">&nbsp;                .growX().fillY()</b>
<b class="nc">&nbsp;                .valid(Strings::canParseInt)</b>
<b class="nc">&nbsp;                .get().setFilter(TextFieldFilter.digitsOnly);</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(int.class, (type, cons) -&gt; cons.get(0));</b>
<b class="nc">&nbsp;        setInterpreter(int.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.field(Integer.toString(get.get()), str -&gt; set.get(Strings.parseInt(str)))</b>
<b class="nc">&nbsp;                .growX().fillY()</b>
<b class="nc">&nbsp;                .valid(Strings::canParseInt)</b>
<b class="nc">&nbsp;                .get().setFilter(TextFieldFilter.digitsOnly);</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(float.class, (type, cons) -&gt; cons.get(0f));</b>
<b class="nc">&nbsp;        setInterpreter(float.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            float m = 1f;</b>
<b class="nc">&nbsp;            if(field != null){</b>
<b class="nc">&nbsp;                if(field.isAnnotationPresent(Second.class)){</b>
<b class="nc">&nbsp;                    m = 60f;</b>
<b class="nc">&nbsp;                }else if(field.isAnnotationPresent(TilePos.class)){</b>
<b class="nc">&nbsp;                    m = 8f;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            float mult = m;</b>
&nbsp;
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.field(Float.toString(get.get() / mult), str -&gt; set.get(Strings.parseFloat(str) * mult))</b>
<b class="nc">&nbsp;                .growX().fillY()</b>
<b class="nc">&nbsp;                .valid(Strings::canParseFloat)</b>
<b class="nc">&nbsp;                .get().setFilter(TextFieldFilter.floatsOnly);</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(UnlockableContent.class, (type, cons) -&gt; cons.get(Blocks.coreShard));</b>
<b class="nc">&nbsp;        setInterpreter(UnlockableContent.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; t.left().button(</b>
<b class="nc">&nbsp;                b -&gt; b.image().size(iconSmall).scaling(Scaling.fit).update(i -&gt; i.setDrawable(get.get().uiIcon)),</b>
<b class="nc">&nbsp;                () -&gt; showContentSelect(null, set, b -&gt; (field != null &amp;&amp; !field.isAnnotationPresent(Researchable.class)) || b.techNode != null)</b>
<b class="nc">&nbsp;            ).fill().pad(4)).growX().fillY();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(Block.class, (type, cons) -&gt; cons.get(Blocks.copperWall));</b>
<b class="nc">&nbsp;        setInterpreter(Block.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; t.left().button(</b>
<b class="nc">&nbsp;                b -&gt; b.image().size(iconSmall).update(i -&gt; i.setDrawable(get.get().uiIcon)),</b>
<b class="nc">&nbsp;                () -&gt; showContentSelect(ContentType.block, set, b -&gt; (field != null &amp;&amp; !field.isAnnotationPresent(Synthetic.class)) || b.synthetic())</b>
<b class="nc">&nbsp;            ).fill().pad(4f)).growX().fillY();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(Item.class, (type, cons) -&gt; cons.get(Items.copper));</b>
<b class="nc">&nbsp;        setInterpreter(Item.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; t.left().button(</b>
<b class="nc">&nbsp;                b -&gt; b.image().size(iconSmall).update(i -&gt; i.setDrawable(get.get().uiIcon)),</b>
<b class="nc">&nbsp;                () -&gt; showContentSelect(ContentType.item, set, item -&gt; true)</b>
<b class="nc">&nbsp;            ).fill().pad(4f)).growX().fillY();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(UnitType.class, (type, cons) -&gt; cons.get(UnitTypes.dagger));</b>
<b class="nc">&nbsp;        setInterpreter(UnitType.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; t.left().button(</b>
<b class="nc">&nbsp;                b -&gt; b.image().size(iconSmall).update(i -&gt; i.setDrawable(get.get().uiIcon)),</b>
<b class="nc">&nbsp;                () -&gt; showContentSelect(ContentType.unit, set, unit -&gt; true)</b>
<b class="nc">&nbsp;            ).fill().pad(4f)).growX().fillY();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(Team.class, (type, cons) -&gt; cons.get(Team.sharded));</b>
<b class="nc">&nbsp;        setInterpreter(Team.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; t.left().button(</b>
<b class="nc">&nbsp;                b -&gt; b.image(Tex.whiteui).size(iconSmall).update(i -&gt; i.setColor(get.get().color)),</b>
<b class="nc">&nbsp;                () -&gt; showTeamSelect(set)</b>
<b class="nc">&nbsp;            ).fill().pad(4f)).growX().fillY();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(Color.class, (type, cons) -&gt; cons.get(Pal.accent.cpy()));</b>
<b class="nc">&nbsp;        setInterpreter(Color.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            var out = get.get();</b>
&nbsp;
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; t.left().button(</b>
<b class="nc">&nbsp;                b -&gt; b.stack(new Image(Tex.alphaBg), new Image(Tex.whiteui){{</b>
<b class="nc">&nbsp;                    update(() -&gt; setColor(out));</b>
<b class="nc">&nbsp;                }}).grow(),</b>
&nbsp;                Styles.squarei,
<b class="nc">&nbsp;                () -&gt; ui.picker.show(out, res -&gt; set.get(out.set(res)))</b>
<b class="nc">&nbsp;            ).margin(4f).pad(4f).size(50f)).growX().fillY();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(Vec2.class, (type, cons) -&gt; cons.get(new Vec2()));</b>
<b class="nc">&nbsp;        setInterpreter(Vec2.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            var obj = get.get();</b>
&nbsp;
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; {</b>
<b class="nc">&nbsp;                boolean isInt = type.raw == int.class;</b>
&nbsp;
<b class="nc">&nbsp;                FieldInterpreter in = getInterpreter(float.class);</b>
<b class="nc">&nbsp;                if(isInt) in = getInterpreter(int.class);</b>
&nbsp;
<b class="nc">&nbsp;                in.build(</b>
<b class="nc">&nbsp;                    t, &quot;x&quot;, new TypeInfo(isInt ? int.class : float.class),</b>
&nbsp;                    field, null, null,
<b class="nc">&nbsp;                    isInt ? () -&gt; (int)obj.x : () -&gt; obj.x,</b>
&nbsp;                    res -&gt; {
<b class="nc">&nbsp;                        obj.x = isInt ? (Integer)res : (Float)res;</b>
<b class="nc">&nbsp;                        set.get(obj);</b>
&nbsp;                    }
&nbsp;                );
&nbsp;
<b class="nc">&nbsp;                in.build(</b>
<b class="nc">&nbsp;                    t.row(), &quot;y&quot;, new TypeInfo(isInt ? int.class : float.class),</b>
&nbsp;                    field, null, null,
<b class="nc">&nbsp;                    isInt ? () -&gt; (int)obj.y : () -&gt; obj.y,</b>
&nbsp;                    res -&gt; {
<b class="nc">&nbsp;                        obj.y = isInt ? (Integer)res : (Float)res;</b>
<b class="nc">&nbsp;                        set.get(obj);</b>
&nbsp;                    }
&nbsp;                );
<b class="nc">&nbsp;            }).growX().fillY();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        setProvider(Point2.class, (type, cons) -&gt; cons.get(new Point2()));</b>
<b class="nc">&nbsp;        setInterpreter(Point2.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            var obj = get.get();</b>
<b class="nc">&nbsp;            var vec = new Vec2(obj.x, obj.y);</b>
<b class="nc">&nbsp;            getInterpreter(Vec2.class).build(</b>
&nbsp;                cont, name, new TypeInfo(int.class),
&nbsp;                field, remover, indexer,
<b class="nc">&nbsp;                () -&gt; vec,</b>
&nbsp;                res -&gt; {
<b class="nc">&nbsp;                    vec.set(res);</b>
<b class="nc">&nbsp;                    set.get(obj.set((int)vec.x, (int)vec.y));</b>
&nbsp;                }
&nbsp;            );
&nbsp;        });
&nbsp;
&nbsp;        // Types that have a provider, but delegate to the default interpreter.
<b class="nc">&nbsp;        setProvider(MapObjective.class, (type, cons) -&gt; new BaseDialog(&quot;@add&quot;){{</b>
<b class="nc">&nbsp;            cont.pane(p -&gt; {</b>
<b class="nc">&nbsp;                p.background(Tex.button);</b>
<b class="nc">&nbsp;                p.marginRight(14f);</b>
<b class="nc">&nbsp;                p.defaults().size(195f, 56f);</b>
&nbsp;
<b class="nc">&nbsp;                int i = 0;</b>
<b class="nc">&nbsp;                for(var gen : MapObjectives.allObjectiveTypes){</b>
<b class="nc">&nbsp;                    var obj = gen.get();</b>
<b class="nc">&nbsp;                    p.button(obj.typeName(), Styles.flatt, () -&gt; {</b>
<b class="nc">&nbsp;                        cons.get(obj);</b>
<b class="nc">&nbsp;                        hide();</b>
<b class="nc">&nbsp;                    }).with(Table::left).get().getLabelCell().growX().left().padLeft(5f).labelAlign(Align.left);</b>
&nbsp;
<b class="nc">&nbsp;                    if(++i % 3 == 0) p.row();</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            }).scrollX(false);</b>
&nbsp;
<b class="nc">&nbsp;            addCloseButton();</b>
<b class="nc">&nbsp;            show();</b>
&nbsp;        }});
&nbsp;
<b class="nc">&nbsp;        setProvider(ObjectiveMarker.class, (type, cons) -&gt; new BaseDialog(&quot;@add&quot;){{</b>
<b class="nc">&nbsp;            cont.pane(p -&gt; {</b>
<b class="nc">&nbsp;                p.background(Tex.button);</b>
<b class="nc">&nbsp;                p.marginRight(14f);</b>
<b class="nc">&nbsp;                p.defaults().size(195f, 56f);</b>
&nbsp;
<b class="nc">&nbsp;                int i = 0;</b>
<b class="nc">&nbsp;                for(var gen : MapObjectives.allMarkerTypes){</b>
<b class="nc">&nbsp;                    var marker = gen.get();</b>
<b class="nc">&nbsp;                    p.button(marker.typeName(), Styles.flatt, () -&gt; {</b>
<b class="nc">&nbsp;                        cons.get(marker);</b>
<b class="nc">&nbsp;                        hide();</b>
<b class="nc">&nbsp;                    }).with(Table::left).get().getLabelCell().growX().left().padLeft(5f).labelAlign(Align.left);</b>
&nbsp;
<b class="nc">&nbsp;                    if(++i % 3 == 0) p.row();</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            }).scrollX(false);</b>
&nbsp;
<b class="nc">&nbsp;            addCloseButton();</b>
<b class="nc">&nbsp;            show();</b>
&nbsp;        }});
&nbsp;
<b class="nc">&nbsp;        setInterpreter(Vertices.class, float[].class, (cont, name, type, field, remover, indexer, get, set) -&gt; cont.table(main -&gt; {</b>
<b class="nc">&nbsp;            float[] data = get.get();</b>
&nbsp;
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; {</b>
<b class="nc">&nbsp;                t.left().defaults().left();</b>
&nbsp;
<b class="nc">&nbsp;                String[] names = {&quot;x&quot;, &quot;y&quot;, &quot;color&quot;, &quot;u&quot;, &quot;v&quot;};</b>
<b class="nc">&nbsp;                int stride = 6;</b>
<b class="nc">&nbsp;                int vertices = data.length / stride;</b>
&nbsp;
<b class="nc">&nbsp;                for(int i = 0; i &lt; vertices; i++){</b>
<b class="nc">&nbsp;                    int offset = i * stride;</b>
&nbsp;
<b class="nc">&nbsp;                    t.table(row -&gt; {</b>
<b class="nc">&nbsp;                        for(int j = 0; j &lt; names.length; j++){</b>
<b class="nc">&nbsp;                            int index = offset + j;</b>
&nbsp;
<b class="nc">&nbsp;                            if(&quot;color&quot;.equals(names[j])) {</b>
<b class="nc">&nbsp;                                getInterpreter(Color.class).build(row, names[j], new TypeInfo(Color.class), null, null, null, () -&gt; new Color().abgr8888(data[index]), value -&gt; data[index] = value.toFloatBits());</b>
&nbsp;                            }else{
<b class="nc">&nbsp;                                float scale = j &lt;= 1 ? tilesize : 1;</b>
<b class="nc">&nbsp;                                getInterpreter(float.class).build(row, names[j], new TypeInfo(float.class), null, null, null, () -&gt; data[index] / scale, value -&gt; data[index] = value * scale);</b>
&nbsp;                            }
&nbsp;
<b class="nc">&nbsp;                            row.add().pad(4);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }).row();</b>
&nbsp;                }
&nbsp;            });
&nbsp;        }));
&nbsp;
&nbsp;        // Types that use the default interpreter. It would be nice if all types could use it, but I don&#39;t know how to reliably prevent classes like [? extends Content] from using it.
<b class="nc">&nbsp;        for(var obj : MapObjectives.allObjectiveTypes) setInterpreter(obj.get().getClass(), defaultInterpreter());</b>
<b class="nc">&nbsp;        for(var mark : MapObjectives.allMarkerTypes) setInterpreter(mark.get().getClass(), defaultInterpreter());</b>
&nbsp;
&nbsp;        // Annotated field interpreters.
<b class="nc">&nbsp;        setInterpreter(LabelFlag.class, byte.class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            name(cont, name, remover, indexer);</b>
<b class="nc">&nbsp;            cont.table(t -&gt; {</b>
<b class="nc">&nbsp;                t.left().defaults().left();</b>
&nbsp;                byte
<b class="nc">&nbsp;                    value = get.get(),</b>
<b class="nc">&nbsp;                    bg = WorldLabel.flagBackground, out = WorldLabel.flagOutline;</b>
&nbsp;
<b class="nc">&nbsp;                t.check(&quot;@marker.background&quot;, (value &amp; bg) == bg, res -&gt; set.get((byte)(res ? value | bg : value &amp; ~bg)))</b>
<b class="nc">&nbsp;                    .growX().fillY()</b>
<b class="nc">&nbsp;                    .padTop(4f).padBottom(4f).get().getLabelCell().growX();</b>
&nbsp;
<b class="nc">&nbsp;                t.row();</b>
<b class="nc">&nbsp;                t.check(&quot;@marker.outline&quot;, (value &amp; out) == out, res -&gt; set.get((byte)(res ? value | out : value &amp; ~out)))</b>
<b class="nc">&nbsp;                    .growX().fillY().get().getLabelCell().growX();</b>
<b class="nc">&nbsp;            }).growX().fillY();</b>
&nbsp;        });
&nbsp;
&nbsp;        // Special data structure interpreters.
&nbsp;        // Instantiate default `Seq`s with a reflectively allocated array.
<b class="nc">&nbsp;        setProvider(Seq.class, (type, cons) -&gt; cons.get(new Seq&lt;&gt;(type.element.raw)));</b>
<b class="nc">&nbsp;        setInterpreter(Seq.class, (cont, name, type, field, remover, indexer, get, set) -&gt; cont.table(main -&gt; {</b>
<b class="nc">&nbsp;            Runnable[] rebuild = {null};</b>
<b class="nc">&nbsp;            var arr = get.get();</b>
&nbsp;
<b class="nc">&nbsp;            main.margin(0f, 10f, 0f, 10f);</b>
<b class="nc">&nbsp;            var header = main.table(Tex.button, t -&gt; {</b>
<b class="nc">&nbsp;                t.left();</b>
<b class="nc">&nbsp;                t.margin(10f);</b>
&nbsp;
<b class="nc">&nbsp;                if(name.length() &gt; 0) t.add(name + &quot;:&quot;).color(Pal.accent);</b>
<b class="nc">&nbsp;                t.add().growX();</b>
&nbsp;
<b class="nc">&nbsp;                if(remover != null) t.button(Icon.trash, Styles.emptyi, remover).fill().padRight(4f);</b>
<b class="nc">&nbsp;                if(indexer != null){</b>
<b class="nc">&nbsp;                    t.button(Icon.upOpen, Styles.emptyi, () -&gt; indexer.get(true)).fill().padRight(4f);</b>
<b class="nc">&nbsp;                    t.button(Icon.downOpen, Styles.emptyi, () -&gt; indexer.get(false)).fill().padRight(4f);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if(!field.isAnnotationPresent(Immutable.class)) {</b>
<b class="nc">&nbsp;                    t.button(Icon.add, Styles.emptyi, () -&gt; getProvider(type.element.raw).get(type.element, res -&gt; {</b>
<b class="nc">&nbsp;                        arr.add(res);</b>
<b class="nc">&nbsp;                        rebuild[0].run();</b>
<b class="nc">&nbsp;                    })).fill();</b>
&nbsp;                }
<b class="nc">&nbsp;            }).growX().height(46f).pad(0f, -10f, 0f, -10f).get();</b>
&nbsp;
<b class="nc">&nbsp;            main.row().table(Tex.button, t -&gt; rebuild[0] = () -&gt; {</b>
<b class="nc">&nbsp;                t.clear();</b>
<b class="nc">&nbsp;                t.top();</b>
&nbsp;
<b class="nc">&nbsp;                if(arr.isEmpty()){</b>
<b class="nc">&nbsp;                    t.background(Tex.clear).margin(0f).setSize(0f);</b>
&nbsp;                }else{
<b class="nc">&nbsp;                    t.background(Tex.button).margin(10f).marginTop(20f);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                for(int i = 0, len = arr.size; i &lt; len; i++){</b>
<b class="nc">&nbsp;                    int index = i;</b>
<b class="nc">&nbsp;                    if(index &gt; 0) t.row();</b>
&nbsp;
<b class="nc">&nbsp;                    getInterpreter((Class&lt;Object&gt;)arr.get(index).getClass()).build(</b>
<b class="nc">&nbsp;                        t, &quot;&quot;, new TypeInfo(arr.get(index).getClass()),</b>
<b class="nc">&nbsp;                        field, field == null || !field.isAnnotationPresent(Immutable.class) ? () -&gt; {</b>
<b class="nc">&nbsp;                            arr.remove(index);</b>
<b class="nc">&nbsp;                            rebuild[0].run();</b>
<b class="nc">&nbsp;                        } : null, field == null || !field.isAnnotationPresent(Unordered.class) ? in -&gt; {</b>
<b class="nc">&nbsp;                            if(in &amp;&amp; index &gt; 0){</b>
<b class="nc">&nbsp;                                arr.swap(index, index - 1);</b>
<b class="nc">&nbsp;                                rebuild[0].run();</b>
<b class="nc">&nbsp;                            }else if(!in &amp;&amp; index &lt; len - 1){</b>
<b class="nc">&nbsp;                                arr.swap(index, index + 1);</b>
<b class="nc">&nbsp;                                rebuild[0].run();</b>
&nbsp;                            }
<b class="nc">&nbsp;                        } : null,</b>
<b class="nc">&nbsp;                        () -&gt; arr.get(index),</b>
&nbsp;                        res -&gt; {
<b class="nc">&nbsp;                            arr.set(index, res);</b>
<b class="nc">&nbsp;                            set.get(arr);</b>
&nbsp;                        }
&nbsp;                    );
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                set.get(arr);</b>
<b class="nc">&nbsp;            }).padTop(-10f).growX().fillY();</b>
<b class="nc">&nbsp;            rebuild[0].run();</b>
&nbsp;
<b class="nc">&nbsp;            header.toFront();</b>
<b class="nc">&nbsp;        }).growX().fillY().pad(4f).colspan(2));</b>
&nbsp;
&nbsp;        // Reserved for array types that are not explicitly handled. Essentially handles it the same way as `Seq`.
<b class="nc">&nbsp;        setProvider(Object[].class, (type, cons) -&gt; cons.get(Reflect.newArray(type.element.raw, 0)));</b>
<b class="nc">&nbsp;        setInterpreter(Object[].class, (cont, name, type, field, remover, indexer, get, set) -&gt; {</b>
<b class="nc">&nbsp;            var arr = Seq.with(get.get());</b>
<b class="nc">&nbsp;            getInterpreter(Seq.class).build(</b>
&nbsp;                cont, name, new TypeInfo(Seq.class, type.element),
&nbsp;                field, remover, indexer,
<b class="nc">&nbsp;                () -&gt; arr,</b>
<b class="nc">&nbsp;                res -&gt; set.get(arr.toArray(type.element.raw))</b>
&nbsp;            );
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; FieldInterpreter&lt;T&gt; defaultInterpreter(){
<b class="nc">&nbsp;        return (cont, name, type, field, remover, indexer, get, set) -&gt; cont.table(main -&gt; {</b>
<b class="nc">&nbsp;            main.margin(0f, 10f, 0f, 10f);</b>
<b class="nc">&nbsp;            var header = main.table(Tex.button, t -&gt; {</b>
<b class="nc">&nbsp;                t.left();</b>
<b class="nc">&nbsp;                t.margin(10f);</b>
&nbsp;
<b class="nc">&nbsp;                if(name.length() &gt; 0) t.add(name + &quot;:&quot;).color(Pal.accent);</b>
<b class="nc">&nbsp;                t.add().growX();</b>
&nbsp;
<b class="nc">&nbsp;                Cell&lt;ImageButton&gt; remove = null;</b>
<b class="nc">&nbsp;                if(remover != null) remove = t.button(Icon.trash, Styles.emptyi, remover).fill();</b>
<b class="nc">&nbsp;                if(indexer != null){</b>
<b class="nc">&nbsp;                    if(remove != null) remove.padRight(4f);</b>
<b class="nc">&nbsp;                    t.button(Icon.upOpen, Styles.emptyi, () -&gt; indexer.get(true)).fill().padRight(4f);</b>
<b class="nc">&nbsp;                    t.button(Icon.downOpen, Styles.emptyi, () -&gt; indexer.get(false)).fill();</b>
&nbsp;                }
<b class="nc">&nbsp;            }).growX().height(46f).pad(0f, -10f, -0f, -10f).get();</b>
&nbsp;
<b class="nc">&nbsp;            main.row().table(Tex.button, t -&gt; {</b>
<b class="nc">&nbsp;                t.left();</b>
<b class="nc">&nbsp;                t.top().margin(10f).marginTop(20f);</b>
&nbsp;
<b class="nc">&nbsp;                t.defaults().minHeight(40f).left();</b>
<b class="nc">&nbsp;                var obj = get.get();</b>
&nbsp;
<b class="nc">&nbsp;                int i = 0;</b>
<b class="nc">&nbsp;                for(var e : JsonIO.json.getFields(type.raw).values()){</b>
<b class="nc">&nbsp;                    if(i++ &gt; 0) t.row();</b>
&nbsp;
<b class="nc">&nbsp;                    var f = e.field;</b>
<b class="nc">&nbsp;                    var ft = f.getType();</b>
<b class="nc">&nbsp;                    int mods = f.getModifiers();</b>
&nbsp;
<b class="nc">&nbsp;                    if(!Modifier.isPublic(mods) || (Modifier.isFinal(mods) &amp;&amp; (</b>
<b class="nc">&nbsp;                        String.class.isAssignableFrom(ft) ||</b>
<b class="nc">&nbsp;                        unbox(ft).isPrimitive()</b>
<b class="nc">&nbsp;                    ))) continue;</b>
&nbsp;
<b class="nc">&nbsp;                    var anno = Structs.find(f.getDeclaredAnnotations(), a -&gt; hasInterpreter(a.annotationType(), ft));</b>
<b class="nc">&nbsp;                    getInterpreter(anno == null ? Override.class : anno.annotationType(), ft).build(</b>
<b class="nc">&nbsp;                        t, f.getName(), new TypeInfo(f),</b>
&nbsp;                        f, null, null,
<b class="nc">&nbsp;                        () -&gt; Reflect.get(obj, f),</b>
<b class="nc">&nbsp;                        Modifier.isFinal(mods) ? res -&gt; {} : res -&gt; Reflect.set(obj, f, res)</b>
&nbsp;                    );
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            }).padTop(-10f).growX().fillY();</b>
&nbsp;
<b class="nc">&nbsp;            header.toFront();</b>
<b class="nc">&nbsp;        }).growX().fillY().pad(4f).colspan(2);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static void name(Table cont, CharSequence name, @Nullable Runnable remover, @Nullable Boolc indexer){
<b class="nc">&nbsp;        if(indexer != null || remover != null){</b>
<b class="nc">&nbsp;            cont.table(t -&gt; {</b>
<b class="nc">&nbsp;                if(remover != null) t.button(Icon.trash, Styles.emptyi, remover).fill().padRight(4f);</b>
<b class="nc">&nbsp;                if(indexer != null){</b>
<b class="nc">&nbsp;                    t.button(Icon.upOpen, Styles.emptyi, () -&gt; indexer.get(true)).fill().padRight(4f);</b>
<b class="nc">&nbsp;                    t.button(Icon.downOpen, Styles.emptyi, () -&gt; indexer.get(false)).fill().padRight(4f);</b>
&nbsp;                }
<b class="nc">&nbsp;            }).fill();</b>
&nbsp;        }else{
<b class="nc">&nbsp;            cont.add(name + &quot;: &quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public MapObjectivesDialog(){
<b class="nc">&nbsp;        super(&quot;@editor.objectives&quot;);</b>
<b class="nc">&nbsp;        clear();</b>
<b class="nc">&nbsp;        margin(0f);</b>
&nbsp;
<b class="nc">&nbsp;        stack(</b>
&nbsp;            new Image(Styles.black5),
&nbsp;            canvas = new MapObjectivesCanvas(),
<b class="nc">&nbsp;            new Table(){{</b>
<b class="nc">&nbsp;                buttons.defaults().size(160f, 64f).pad(2f);</b>
<b class="nc">&nbsp;                buttons.button(&quot;@back&quot;, Icon.left, MapObjectivesDialog.this::hide);</b>
<b class="nc">&nbsp;                buttons.button(&quot;@add&quot;, Icon.add, () -&gt; getProvider(MapObjective.class).get(new TypeInfo(MapObjective.class), canvas::query));</b>
<b class="nc">&nbsp;                buttons.button(&quot;@waves.edit&quot;, Icon.edit, () -&gt; {</b>
<b class="nc">&nbsp;                    BaseDialog dialog = new BaseDialog(&quot;@waves.edit&quot;);</b>
<b class="nc">&nbsp;                    dialog.addCloseButton();</b>
<b class="nc">&nbsp;                    dialog.setFillParent(false);</b>
<b class="nc">&nbsp;                    dialog.cont.table(Tex.button, t -&gt; {</b>
<b class="nc">&nbsp;                        var style = Styles.cleart;</b>
<b class="nc">&nbsp;                        t.defaults().size(280f, 64f).pad(2f);</b>
&nbsp;
<b class="nc">&nbsp;                        t.button(&quot;@waves.copy&quot;, Icon.copy, style, () -&gt; {</b>
<b class="nc">&nbsp;                            ui.showInfoFade(&quot;@copied&quot;);</b>
<b class="nc">&nbsp;                            Core.app.setClipboardText(JsonIO.write(new MapObjectives(canvas.objectives)));</b>
<b class="nc">&nbsp;                            dialog.hide();</b>
<b class="nc">&nbsp;                        }).disabled(b -&gt; canvas.objectives.isEmpty()).marginLeft(12f).row();</b>
&nbsp;
<b class="nc">&nbsp;                        t.button(&quot;@waves.load&quot;, Icon.download, style, () -&gt; {</b>
&nbsp;                            try{
<b class="nc">&nbsp;                                rebuildObjectives(new Seq&lt;&gt;(JsonIO.read(MapObjectives.class, Core.app.getClipboardText()).all));</b>
<b class="nc">&nbsp;                            }catch(Exception e){</b>
<b class="nc">&nbsp;                                Log.err(e);</b>
<b class="nc">&nbsp;                                ui.showErrorMessage(&quot;@waves.invalid&quot;);</b>
<b class="nc">&nbsp;                            }</b>
<b class="nc">&nbsp;                            dialog.hide();</b>
<b class="nc">&nbsp;                        }).disabled(Core.app.getClipboardText() == null || !Core.app.getClipboardText().startsWith(&quot;[&quot;)).marginLeft(12f).row();</b>
&nbsp;
<b class="nc">&nbsp;                        t.button(&quot;@clear&quot;, Icon.none, style, () -&gt; ui.showConfirm(&quot;@confirm&quot;, &quot;@settings.clear.confirm&quot;, () -&gt; {</b>
<b class="nc">&nbsp;                            rebuildObjectives(new Seq&lt;&gt;());</b>
<b class="nc">&nbsp;                            dialog.hide();</b>
<b class="nc">&nbsp;                        })).marginLeft(12f).row();</b>
&nbsp;                    });
&nbsp;
<b class="nc">&nbsp;                    dialog.show();</b>
&nbsp;                });
&nbsp;
<b class="nc">&nbsp;                if(mobile){</b>
<b class="nc">&nbsp;                    buttons.button(&quot;@cancel&quot;, Icon.cancel, canvas::stopQuery).visible(() -&gt; canvas.isQuerying());</b>
<b class="nc">&nbsp;                    buttons.button(&quot;@ok&quot;, Icon.ok, canvas::placeQuery).visible(() -&gt; canvas.isQuerying());</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                setFillParent(true);</b>
<b class="nc">&nbsp;                margin(3f);</b>
&nbsp;
<b class="nc">&nbsp;                add(titleTable).growX().fillY();</b>
<b class="nc">&nbsp;                row().add().grow();</b>
<b class="nc">&nbsp;                row().add(buttons).fill();</b>
<b class="nc">&nbsp;                addCloseListener();</b>
&nbsp;            }}
<b class="nc">&nbsp;        ).grow().pad(0f).margin(0f);</b>
&nbsp;
<b class="nc">&nbsp;        hidden(() -&gt; {</b>
<b class="nc">&nbsp;            out.get(canvas.objectives);</b>
<b class="nc">&nbsp;            out = arr -&gt; {};</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    public void show(Seq&lt;MapObjective&gt; objectives, Cons&lt;Seq&lt;MapObjective&gt;&gt; out){
<b class="nc">&nbsp;        this.out = out;</b>
&nbsp;
<b class="nc">&nbsp;        rebuildObjectives(objectives);</b>
<b class="nc">&nbsp;        show();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void rebuildObjectives(Seq&lt;MapObjective&gt; objectives){
<b class="nc">&nbsp;        canvas.clearObjectives();</b>
<b class="nc">&nbsp;        if(</b>
<b class="nc">&nbsp;        objectives.any() &amp;&amp; (</b>
&nbsp;        // If the objectives were previously programmatically made...
<b class="nc">&nbsp;        objectives.contains(obj -&gt; obj.editorX == -1 || obj.editorY == -1) ||</b>
&nbsp;        // ... or some idiot somehow made it not work...
<b class="nc">&nbsp;        objectives.contains(obj -&gt; !canvas.tilemap.createTile(obj))</b>
&nbsp;        )){
&nbsp;            // ... then rebuild the structure.
<b class="nc">&nbsp;            canvas.clearObjectives();</b>
&nbsp;
&nbsp;            // This is definitely NOT a good way to do it, but only insane people or people from the distant past would actually encounter this anyway.
<b class="nc">&nbsp;            int w = objWidth + 2,</b>
<b class="nc">&nbsp;            len = objectives.size * w,</b>
<b class="nc">&nbsp;            columns = objectives.size,</b>
<b class="nc">&nbsp;            rows = 1;</b>
&nbsp;
<b class="nc">&nbsp;            if(len &gt; bounds){</b>
<b class="nc">&nbsp;                rows = len / bounds;</b>
<b class="nc">&nbsp;                columns = bounds / w;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int i = 0;</b>
&nbsp;            loop:
<b class="nc">&nbsp;            for(int y = 0; y &lt; rows; y++){</b>
<b class="nc">&nbsp;                for(int x = 0; x &lt; columns; x++){</b>
<b class="nc">&nbsp;                    if(canvas.tilemap.createTile(x * w, y, objectives.get(i))){</b>
<b class="nc">&nbsp;                        i++;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if(i &gt;= objectives.size) break loop;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        canvas.objectives.set(objectives);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T extends UnlockableContent&gt; void showContentSelect(@Nullable ContentType type, Cons&lt;T&gt; cons, Boolf&lt;T&gt; check){
<b class="nc">&nbsp;        BaseDialog dialog = new BaseDialog(&quot;&quot;);</b>
<b class="nc">&nbsp;        dialog.cont.pane(Styles.noBarPane, t -&gt; {</b>
<b class="nc">&nbsp;            int i = 0;</b>
<b class="nc">&nbsp;            for(var content : (type == null ? content.blocks().copy().&lt;UnlockableContent&gt;as()</b>
<b class="nc">&nbsp;                .add(content.items())</b>
<b class="nc">&nbsp;                .add(content.liquids())</b>
<b class="nc">&nbsp;                .add(content.units()) :</b>
<b class="nc">&nbsp;                content.getBy(type).&lt;UnlockableContent&gt;as()</b>
&nbsp;            )){
<b class="nc">&nbsp;                if(content.isHidden() || !check.get((T)content)) continue;</b>
<b class="nc">&nbsp;                t.image(content == Blocks.air ? Icon.none.getRegion() : content.uiIcon).size(iconMed).pad(3).scaling(Scaling.fit)</b>
<b class="nc">&nbsp;                    .with(b -&gt; b.addListener(new HandCursorListener()))</b>
<b class="nc">&nbsp;                    .tooltip(content.localizedName).get().clicked(() -&gt; {</b>
<b class="nc">&nbsp;                        cons.get((T)content);</b>
<b class="nc">&nbsp;                        dialog.hide();</b>
&nbsp;                    });
&nbsp;
<b class="nc">&nbsp;                if(++i % 10 == 0) t.row();</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }).fill();</b>
&nbsp;
<b class="nc">&nbsp;        dialog.closeOnBack();</b>
<b class="nc">&nbsp;        dialog.show();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static void showTeamSelect(Cons&lt;Team&gt; cons){
<b class="nc">&nbsp;        BaseDialog dialog = new BaseDialog(&quot;&quot;);</b>
<b class="nc">&nbsp;        for(var team : Team.baseTeams){</b>
<b class="nc">&nbsp;            dialog.cont.image(Tex.whiteui).size(iconMed).color(team.color).pad(4)</b>
<b class="nc">&nbsp;                .with(i -&gt; i.addListener(new HandCursorListener()))</b>
<b class="nc">&nbsp;                .tooltip(team.localized()).get().clicked(() -&gt; {</b>
<b class="nc">&nbsp;                    cons.get(team);</b>
<b class="nc">&nbsp;                    dialog.hide();</b>
&nbsp;                });
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        dialog.closeOnBack();</b>
<b class="nc">&nbsp;        dialog.show();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Class&lt;?&gt; unbox(Class&lt;?&gt; boxed){
<b class="nc">&nbsp;        return switch(boxed.getSimpleName()){</b>
<b class="nc">&nbsp;            case &quot;Boolean&quot; -&gt; boolean.class;</b>
<b class="nc">&nbsp;            case &quot;Byte&quot; -&gt; byte.class;</b>
<b class="nc">&nbsp;            case &quot;Character&quot; -&gt; char.class;</b>
<b class="nc">&nbsp;            case &quot;Short&quot; -&gt; short.class;</b>
<b class="nc">&nbsp;            case &quot;Integer&quot; -&gt; int.class;</b>
<b class="nc">&nbsp;            case &quot;Long&quot; -&gt; long.class;</b>
<b class="nc">&nbsp;            case &quot;Float&quot; -&gt; float.class;</b>
<b class="nc">&nbsp;            case &quot;Double&quot; -&gt; double.class;</b>
<b class="nc">&nbsp;            default -&gt; boxed;</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; void setInterpreter(Class&lt;T&gt; type, FieldInterpreter&lt;? super T&gt; interpreter){
<b class="nc">&nbsp;        setInterpreter(Override.class, type, interpreter);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; void setInterpreter(Class&lt;? extends Annotation&gt; anno, Class&lt;T&gt; type, FieldInterpreter&lt;? super T&gt; interpreter){
<b class="nc">&nbsp;        interpreters.get(anno, ObjectMap::new).put(type, interpreter);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean hasInterpreter(Class&lt;?&gt; type){
<b class="nc">&nbsp;        return hasInterpreter(Override.class, type);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean hasInterpreter(Class&lt;? extends Annotation&gt; anno, Class&lt;?&gt; type){
<b class="nc">&nbsp;        return interpreters.get(anno, ObjectMap::new).containsKey(unbox(type));</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; FieldInterpreter&lt;T&gt; getInterpreter(Class&lt;T&gt; type){
<b class="nc">&nbsp;        return getInterpreter(Override.class, type);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; FieldInterpreter&lt;T&gt; getInterpreter(Class&lt;? extends Annotation&gt; anno, Class&lt;T&gt; type){
<b class="nc">&nbsp;        if(hasInterpreter(anno, type)){</b>
<b class="nc">&nbsp;            return (FieldInterpreter&lt;T&gt;)interpreters.get(anno, ObjectMap::new).get(unbox(type));</b>
<b class="nc">&nbsp;        }else if(hasInterpreter(Override.class, type)){</b>
<b class="nc">&nbsp;            return (FieldInterpreter&lt;T&gt;)interpreters.get(Override.class, ObjectMap::new).get(unbox(type));</b>
<b class="nc">&nbsp;        }else if(type.isArray() &amp;&amp; !type.getComponentType().isPrimitive()){</b>
<b class="nc">&nbsp;            return (FieldInterpreter&lt;T&gt;)(hasInterpreter(anno, Object[].class)</b>
<b class="nc">&nbsp;                ? interpreters.get(anno).get(Object[].class)</b>
<b class="nc">&nbsp;                : interpreters.get(Override.class).get(Object[].class)</b>
&nbsp;            );
&nbsp;        }else{
<b class="nc">&nbsp;            throw new IllegalArgumentException(&quot;Interpreter for type &quot; + type + &quot; not set up yet.&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; void setProvider(Class&lt;T&gt; type, FieldProvider&lt;T&gt; provider){
<b class="nc">&nbsp;        providers.put(unbox(type), provider);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean hasProvider(Class&lt;?&gt; type){
<b class="nc">&nbsp;        return providers.containsKey(unbox(type));</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; FieldProvider&lt;T&gt; getProvider(Class&lt;T&gt; type){
<b class="nc">&nbsp;        return (FieldProvider&lt;T&gt;)providers.getThrow(unbox(type), () -&gt; new IllegalArgumentException(&quot;Provider for type &quot; + type + &quot; not set up yet.&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    public interface FieldInterpreter&lt;T&gt;{
&nbsp;        /**
&nbsp;         * Builds the interpreter for (not-necessarily) a possibly annotated field. Implementations must add exactly
&nbsp;         * 2 columns to the table.
&nbsp;         * @param name    May be empty.
&nbsp;         * @param remover If this callback is not {@code null}, this interpreter should add a button that invokes the
&nbsp;         *                callback to signal element removal.
&nbsp;         * @param indexer If this callback is not {@code null}, this interpreter should add 2 buttons that invoke the
&nbsp;         *                callback to signal element rearrangement with the following values:&lt;ul&gt;
&nbsp;         *                &lt;li&gt;{@code true}: Swap element with previous index.&lt;/li&gt;
&nbsp;         *                &lt;li&gt;{@code false}: Swap element with next index.&lt;/li&gt;
&nbsp;         *                &lt;/ul&gt;
&nbsp;         */
&nbsp;        void build(Table cont,
&nbsp;                   CharSequence name, TypeInfo type,
&nbsp;                   @Nullable Field field,
&nbsp;                   @Nullable Runnable remover, @Nullable Boolc indexer,
&nbsp;                   Prov&lt;T&gt; get, Cons&lt;T&gt; set);
&nbsp;    }
&nbsp;
&nbsp;    public interface FieldProvider&lt;T&gt;{
&nbsp;        void get(TypeInfo type, Cons&lt;T&gt; cons);
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Stores parameterized or array type information for convenience.
&nbsp;     * For {@code A[]}: {@link #raw} is {@code A[]}, {@link #element} is {@code A}, {@link #key} is {@code null}.
&nbsp;     * For {@code Seq&lt;A&gt;}: {@link #raw} is {@link Seq}, {@link #element} is {@code A}, {@link #key} is {@code null}.
&nbsp;     * For {@code ObjectMap&lt;A, B&gt;}: {@link #raw} is {@link ObjectMap}, {@link #element} is {@code B}, {@link #key} is {@code A}.
&nbsp;     */
&nbsp;    public static class TypeInfo{
&nbsp;        public final Class&lt;?&gt; raw;
&nbsp;        public final TypeInfo element, key;
&nbsp;
&nbsp;        public TypeInfo(Field field){
<b class="nc">&nbsp;            this(field.getType(), field.getGenericType());</b>
&nbsp;        }
&nbsp;
&nbsp;        public TypeInfo(Class&lt;?&gt; raw){
<b class="nc">&nbsp;            this(raw, raw);</b>
&nbsp;        }
&nbsp;
&nbsp;        /** Use with care! */
<b class="nc">&nbsp;        public TypeInfo(Class&lt;?&gt; raw, TypeInfo element){</b>
<b class="nc">&nbsp;            this.raw = unbox(raw);</b>
<b class="nc">&nbsp;            this.element = element;</b>
<b class="nc">&nbsp;            key = null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        public TypeInfo(Class&lt;?&gt; raw, Type generic){</b>
<b class="nc">&nbsp;            this.raw = unbox(raw);</b>
<b class="nc">&nbsp;            if(raw.isArray()){</b>
<b class="nc">&nbsp;                key = null;</b>
<b class="nc">&nbsp;                element = new TypeInfo(raw.getComponentType(), generic instanceof GenericArrayType type ? type.getGenericComponentType() : raw.getComponentType());</b>
<b class="nc">&nbsp;            }else if(Seq.class.isAssignableFrom(raw)){</b>
<b class="nc">&nbsp;                key = null;</b>
<b class="nc">&nbsp;                element = getParam(generic, 0);</b>
<b class="nc">&nbsp;            }else if(ObjectMap.class.isAssignableFrom(raw)){</b>
<b class="nc">&nbsp;                key = getParam(generic, 0);</b>
<b class="nc">&nbsp;                element = getParam(generic, 1);</b>
&nbsp;            }else{
<b class="nc">&nbsp;                key = element = null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public static TypeInfo getParam(Type generic, int index){
&nbsp;            Type[] params =
<b class="nc">&nbsp;                generic instanceof ParameterizedType type ? type.getActualTypeArguments() :</b>
<b class="nc">&nbsp;                generic instanceof GenericDeclaration type ? type.getTypeParameters() : null;</b>
&nbsp;
<b class="nc">&nbsp;            if(params != null &amp;&amp; index &lt; params.length){</b>
<b class="nc">&nbsp;                var target = params[index];</b>
<b class="nc">&nbsp;                return new TypeInfo(raw(target), target);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return new TypeInfo(Object.class, Object.class);</b>
&nbsp;        }
&nbsp;
&nbsp;        public static Class&lt;?&gt; raw(Type type){
<b class="nc">&nbsp;            if(type instanceof Class&lt;?&gt; c) return c;</b>
<b class="nc">&nbsp;            if(type instanceof ParameterizedType c) return (Class&lt;?&gt;)c.getRawType();</b>
<b class="nc">&nbsp;            if(type instanceof GenericArrayType c) return Reflect.newArray(raw(c.getGenericComponentType()), 0).getClass();</b>
<b class="nc">&nbsp;            if(type instanceof TypeVariable&lt;?&gt; c) return raw(c.getBounds()[0]);</b>
<b class="nc">&nbsp;            return Object.class;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-10-10 15:59</div>
</div>
</body>
</html>
