


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > LCanvas</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">mindustry.logic</a>
</div>

<h1>Coverage Summary for Class: LCanvas (mindustry.logic)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">LCanvas</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/67)
  </span>
</td>
</tr>
  <tr>
    <td class="name">LCanvas$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LCanvas$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LCanvas$DragLayout</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/59)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LCanvas$JumpButton</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LCanvas$JumpButton$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LCanvas$JumpButton$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LCanvas$JumpCurve</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/32)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LCanvas$StatementElem</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/52)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LCanvas$StatementElem$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/47)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/275)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package mindustry.logic;
&nbsp;
&nbsp;import arc.*;
&nbsp;import arc.func.*;
&nbsp;import arc.graphics.*;
&nbsp;import arc.graphics.g2d.*;
&nbsp;import arc.input.*;
&nbsp;import arc.math.*;
&nbsp;import arc.math.geom.*;
&nbsp;import arc.scene.*;
&nbsp;import arc.scene.event.*;
&nbsp;import arc.scene.ui.*;
&nbsp;import arc.scene.ui.layout.*;
&nbsp;import arc.struct.*;
&nbsp;import arc.util.*;
&nbsp;import mindustry.*;
&nbsp;import mindustry.gen.*;
&nbsp;import mindustry.graphics.*;
&nbsp;import mindustry.logic.LStatements.*;
&nbsp;import mindustry.ui.*;
&nbsp;
&nbsp;public class LCanvas extends Table{
&nbsp;    public static final int maxJumpsDrawn = 100;
&nbsp;    //ew static variables
&nbsp;    static LCanvas canvas;
&nbsp;
&nbsp;    public DragLayout statements;
&nbsp;    public ScrollPane pane;
&nbsp;    public Group jumps;
&nbsp;
&nbsp;    StatementElem dragging;
&nbsp;    StatementElem hovered;
&nbsp;    float targetWidth;
<b class="nc">&nbsp;    int jumpCount = 0;</b>
&nbsp;    boolean privileged;
<b class="nc">&nbsp;    Seq&lt;Tooltip&gt; tooltips = new Seq&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;    public LCanvas(){</b>
<b class="nc">&nbsp;        canvas = this;</b>
&nbsp;
<b class="nc">&nbsp;        Core.scene.addListener(new InputListener(){</b>
&nbsp;            @Override
&nbsp;            public boolean touchDown(InputEvent event, float x, float y, int pointer, KeyCode button){
&nbsp;                //hide tooltips on tap
<b class="nc">&nbsp;                for(var t : tooltips){</b>
<b class="nc">&nbsp;                    t.container.toFront();</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                Core.app.post(() -&gt; {</b>
<b class="nc">&nbsp;                    tooltips.each(Tooltip::hide);</b>
<b class="nc">&nbsp;                    tooltips.clear();</b>
&nbsp;                });
<b class="nc">&nbsp;                return super.touchDown(event, x, y, pointer, button);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        rebuild();</b>
&nbsp;    }
&nbsp;
&nbsp;    /** @return if statement elements should have rows. */
&nbsp;    public static boolean useRows(){
<b class="nc">&nbsp;        return Core.graphics.getWidth() &lt; Scl.scl(900f) * 1.2f;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static void tooltip(Cell&lt;?&gt; cell, String key){
<b class="nc">&nbsp;        String lkey = key.toLowerCase().replace(&quot; &quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;        if(Core.settings.getBool(&quot;logichints&quot;, true) &amp;&amp; Core.bundle.has(lkey)){</b>
<b class="nc">&nbsp;            var tip = new Tooltip(t -&gt; t.background(Styles.black8).margin(4f).add(&quot;[lightgray]&quot; + Core.bundle.get(lkey)).style(Styles.outlineLabel));</b>
&nbsp;
&nbsp;            //mobile devices need long-press tooltips
<b class="nc">&nbsp;            if(Vars.mobile){</b>
<b class="nc">&nbsp;                cell.get().addListener(new ElementGestureListener(20, 0.4f, 0.43f, 0.15f){</b>
&nbsp;                    @Override
&nbsp;                    public boolean longPress(Element element, float x, float y){
<b class="nc">&nbsp;                        tip.show(element, x, y);</b>
<b class="nc">&nbsp;                        canvas.tooltips.add(tip);</b>
&nbsp;                        //prevent touch down for other listeners
<b class="nc">&nbsp;                        for(var list : cell.get().getListeners()){</b>
<b class="nc">&nbsp;                            if(list instanceof ClickListener cl){</b>
<b class="nc">&nbsp;                                cl.cancel();</b>
&nbsp;                            }
<b class="nc">&nbsp;                        }</b>
<b class="nc">&nbsp;                        return true;</b>
&nbsp;                    }
&nbsp;                });
&nbsp;            }else{
<b class="nc">&nbsp;                cell.get().addListener(tip);</b>
&nbsp;            }
&nbsp;
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static void tooltip(Cell&lt;?&gt; cell, Enum&lt;?&gt; key){
<b class="nc">&nbsp;        String cl = key.getClass().getSimpleName().toLowerCase() + &quot;.&quot; + key.name().toLowerCase();</b>
<b class="nc">&nbsp;        if(Core.bundle.has(cl)){</b>
<b class="nc">&nbsp;            tooltip(cell, cl);</b>
&nbsp;        }else{
<b class="nc">&nbsp;            tooltip(cell, &quot;lenum.&quot; + key.name());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void rebuild(){
<b class="nc">&nbsp;        targetWidth = useRows() ? 400f : 900f;</b>
<b class="nc">&nbsp;        float s = pane != null ? pane.getVisualScrollY() : 0f;</b>
<b class="nc">&nbsp;        String toLoad = statements != null ? save() : null;</b>
&nbsp;
<b class="nc">&nbsp;        clear();</b>
&nbsp;
<b class="nc">&nbsp;        statements = new DragLayout();</b>
<b class="nc">&nbsp;        jumps = new WidgetGroup();</b>
&nbsp;
<b class="nc">&nbsp;        pane = pane(t -&gt; {</b>
<b class="nc">&nbsp;            t.center();</b>
<b class="nc">&nbsp;            t.add(statements).pad(2f).center().width(targetWidth);</b>
<b class="nc">&nbsp;            t.addChild(jumps);</b>
&nbsp;
<b class="nc">&nbsp;            jumps.cullable = false;</b>
<b class="nc">&nbsp;        }).grow().get();</b>
<b class="nc">&nbsp;        pane.setFlickScroll(false);</b>
<b class="nc">&nbsp;        pane.setScrollYForce(s);</b>
&nbsp;
<b class="nc">&nbsp;        if(toLoad != null){</b>
<b class="nc">&nbsp;            load(toLoad);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void draw(){
<b class="nc">&nbsp;        jumpCount = 0;</b>
<b class="nc">&nbsp;        super.draw();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void add(LStatement statement){
<b class="nc">&nbsp;        statements.addChild(new StatementElem(statement));</b>
&nbsp;    }
&nbsp;
&nbsp;    public String save(){
<b class="nc">&nbsp;        Seq&lt;LStatement&gt; st = statements.getChildren().&lt;StatementElem&gt;as().map(s -&gt; s.st);</b>
<b class="nc">&nbsp;        st.each(LStatement::saveUI);</b>
&nbsp;
<b class="nc">&nbsp;        return LAssembler.write(st);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void load(String asm){
<b class="nc">&nbsp;        jumps.clear();</b>
&nbsp;
<b class="nc">&nbsp;        Seq&lt;LStatement&gt; statements = LAssembler.read(asm, privileged);</b>
<b class="nc">&nbsp;        statements.truncate(LExecutor.maxInstructions);</b>
<b class="nc">&nbsp;        this.statements.clearChildren();</b>
<b class="nc">&nbsp;        for(LStatement st : statements){</b>
<b class="nc">&nbsp;            add(st);</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        for(LStatement st : statements){</b>
<b class="nc">&nbsp;            st.setupUI();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        this.statements.layout();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void clearStatements(){
<b class="nc">&nbsp;        jumps.clear();</b>
<b class="nc">&nbsp;        statements.clearChildren();</b>
<b class="nc">&nbsp;        statements.layout();</b>
&nbsp;    }
&nbsp;
&nbsp;    StatementElem checkHovered(){
<b class="nc">&nbsp;        Element e = Core.scene.getHoverElement();</b>
<b class="nc">&nbsp;        if(e != null){</b>
<b class="nc">&nbsp;            while(e != null &amp;&amp; !(e instanceof StatementElem)){</b>
<b class="nc">&nbsp;                e = e.parent;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if(e == null || isDescendantOf(e)) return null;</b>
<b class="nc">&nbsp;        return (StatementElem)e;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void act(float delta){
<b class="nc">&nbsp;        super.act(delta);</b>
&nbsp;
<b class="nc">&nbsp;        hovered = checkHovered();</b>
&nbsp;
<b class="nc">&nbsp;        if(Core.input.isTouched()){</b>
<b class="nc">&nbsp;            float y = Core.input.mouseY();</b>
<b class="nc">&nbsp;            float dst = Math.min(y - this.y, Core.graphics.getHeight() - y);</b>
<b class="nc">&nbsp;            if(dst &lt; Scl.scl(100f)){ //scroll margin</b>
<b class="nc">&nbsp;                int sign = Mathf.sign(Core.graphics.getHeight()/2f - y);</b>
<b class="nc">&nbsp;                pane.setScrollY(pane.getScrollY() + sign * Scl.scl(15f) * Time.delta);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    public class DragLayout extends WidgetGroup{</b>
<b class="nc">&nbsp;        float space = Scl.scl(10f), prefWidth, prefHeight;</b>
<b class="nc">&nbsp;        Seq&lt;Element&gt; seq = new Seq&lt;&gt;();</b>
<b class="nc">&nbsp;        int insertPosition = 0;</b>
&nbsp;        boolean invalidated;
&nbsp;
&nbsp;        {
<b class="nc">&nbsp;            setTransform(true);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void layout(){
<b class="nc">&nbsp;            invalidated = true;</b>
<b class="nc">&nbsp;            float cy = 0;</b>
<b class="nc">&nbsp;            seq.clear();</b>
&nbsp;
<b class="nc">&nbsp;            float totalHeight = getChildren().sumf(e -&gt; e.getHeight() + space);</b>
&nbsp;
<b class="nc">&nbsp;            height = prefHeight = totalHeight;</b>
<b class="nc">&nbsp;            width = prefWidth = Scl.scl(targetWidth);</b>
&nbsp;
&nbsp;            //layout everything normally
<b class="nc">&nbsp;            for(int i = 0; i &lt; getChildren().size; i++){</b>
<b class="nc">&nbsp;                Element e = getChildren().get(i);</b>
&nbsp;
&nbsp;                //ignore the dragged element
<b class="nc">&nbsp;                if(dragging == e) continue;</b>
&nbsp;
<b class="nc">&nbsp;                e.setSize(width, e.getPrefHeight());</b>
<b class="nc">&nbsp;                e.setPosition(0, height - cy, Align.topLeft);</b>
<b class="nc">&nbsp;                ((StatementElem)e).updateAddress(i);</b>
&nbsp;
<b class="nc">&nbsp;                cy += e.getPrefHeight() + space;</b>
<b class="nc">&nbsp;                seq.add(e);</b>
&nbsp;            }
&nbsp;
&nbsp;            //insert the dragged element if necessary
<b class="nc">&nbsp;            if(dragging != null){</b>
&nbsp;                //find real position of dragged element top
<b class="nc">&nbsp;                float realY = dragging.getY(Align.top) + dragging.translation.y;</b>
&nbsp;
<b class="nc">&nbsp;                insertPosition = 0;</b>
&nbsp;
<b class="nc">&nbsp;                for(int i = 0; i &lt; seq.size; i++){</b>
<b class="nc">&nbsp;                    Element cur = seq.get(i);</b>
&nbsp;                    //find fit point
<b class="nc">&nbsp;                    if(realY &lt; cur.y &amp;&amp; (i == seq.size - 1 || realY &gt; seq.get(i + 1).y)){</b>
<b class="nc">&nbsp;                        insertPosition = i + 1;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                float shiftAmount = dragging.getHeight() + space;</b>
&nbsp;
&nbsp;                //shift elements below insertion point down
<b class="nc">&nbsp;                for(int i = insertPosition; i &lt; seq.size; i++){</b>
<b class="nc">&nbsp;                    seq.get(i).y -= shiftAmount;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if(parent != null) parent.invalidateHierarchy();</b>
&nbsp;
<b class="nc">&nbsp;            if(parent != null &amp;&amp; parent instanceof Table){</b>
<b class="nc">&nbsp;                setCullingArea(parent.getCullingArea());</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public float getPrefWidth(){
<b class="nc">&nbsp;            return prefWidth;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public float getPrefHeight(){
<b class="nc">&nbsp;            return prefHeight;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void draw(){
<b class="nc">&nbsp;            Draw.alpha(parentAlpha);</b>
&nbsp;
&nbsp;            //draw selection box indicating placement position
<b class="nc">&nbsp;            if(dragging != null &amp;&amp; insertPosition &lt;= seq.size){</b>
<b class="nc">&nbsp;                float shiftAmount = dragging.getHeight();</b>
<b class="nc">&nbsp;                float lastX = x;</b>
<b class="nc">&nbsp;                float lastY = insertPosition == 0 ? height + y : seq.get(insertPosition - 1).y + y - space;</b>
&nbsp;
<b class="nc">&nbsp;                Tex.pane.draw(lastX, lastY - shiftAmount, width, dragging.getHeight());</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if(invalidated){</b>
<b class="nc">&nbsp;                children.each(c -&gt; c.cullable = false);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            super.draw();</b>
&nbsp;
<b class="nc">&nbsp;            if(invalidated){</b>
<b class="nc">&nbsp;                children.each(c -&gt; c.cullable = true);</b>
<b class="nc">&nbsp;                invalidated = false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        void finishLayout(){
<b class="nc">&nbsp;            if(dragging != null){</b>
&nbsp;                //reset translation first
<b class="nc">&nbsp;                for(Element child : getChildren()){</b>
<b class="nc">&nbsp;                    child.setTranslation(0, 0);</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                clearChildren();</b>
&nbsp;
&nbsp;                //reorder things
<b class="nc">&nbsp;                for(int i = 0; i &lt;= insertPosition - 1 &amp;&amp; i &lt; seq.size; i++){</b>
<b class="nc">&nbsp;                    addChild(seq.get(i));</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                addChild(dragging);</b>
&nbsp;
<b class="nc">&nbsp;                for(int i = insertPosition; i &lt; seq.size; i++){</b>
<b class="nc">&nbsp;                    addChild(seq.get(i));</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                dragging = null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            layout();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public class StatementElem extends Table{
&nbsp;        public LStatement st;
&nbsp;        public int index;
&nbsp;        Label addressLabel;
&nbsp;
<b class="nc">&nbsp;        public StatementElem(LStatement st){</b>
<b class="nc">&nbsp;            this.st = st;</b>
<b class="nc">&nbsp;            st.elem = this;</b>
&nbsp;
<b class="nc">&nbsp;            background(Tex.whitePane);</b>
<b class="nc">&nbsp;            setColor(st.category().color);</b>
<b class="nc">&nbsp;            margin(0f);</b>
<b class="nc">&nbsp;            touchable = Touchable.enabled;</b>
&nbsp;
<b class="nc">&nbsp;            table(Tex.whiteui, t -&gt; {</b>
<b class="nc">&nbsp;                t.color.set(color);</b>
<b class="nc">&nbsp;                t.addListener(new HandCursorListener());</b>
&nbsp;
<b class="nc">&nbsp;                t.margin(6f);</b>
<b class="nc">&nbsp;                t.touchable = Touchable.enabled;</b>
&nbsp;
<b class="nc">&nbsp;                t.add(st.name()).style(Styles.outlineLabel).name(&quot;statement-name&quot;).color(color).padRight(8);</b>
<b class="nc">&nbsp;                t.add().growX();</b>
&nbsp;
<b class="nc">&nbsp;                addressLabel = t.add(index + &quot;&quot;).style(Styles.outlineLabel).color(color).padRight(8).get();</b>
&nbsp;
<b class="nc">&nbsp;                t.button(Icon.copy, Styles.logici, () -&gt; {</b>
<b class="nc">&nbsp;                }).size(24f).padRight(6).get().tapped(this::copy);</b>
&nbsp;
<b class="nc">&nbsp;                t.button(Icon.cancel, Styles.logici, () -&gt; {</b>
<b class="nc">&nbsp;                    remove();</b>
<b class="nc">&nbsp;                    dragging = null;</b>
<b class="nc">&nbsp;                    statements.layout();</b>
<b class="nc">&nbsp;                }).size(24f);</b>
&nbsp;
<b class="nc">&nbsp;                t.addListener(new InputListener(){</b>
&nbsp;                    float lastx, lasty;
&nbsp;
&nbsp;                    @Override
&nbsp;                    public boolean touchDown(InputEvent event, float x, float y, int pointer, KeyCode button){
&nbsp;
<b class="nc">&nbsp;                        if(button == KeyCode.mouseMiddle){</b>
<b class="nc">&nbsp;                            copy();</b>
<b class="nc">&nbsp;                            return false;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        Vec2 v = localToParentCoordinates(Tmp.v1.set(x, y));</b>
<b class="nc">&nbsp;                        lastx = v.x;</b>
<b class="nc">&nbsp;                        lasty = v.y;</b>
<b class="nc">&nbsp;                        dragging = StatementElem.this;</b>
<b class="nc">&nbsp;                        toFront();</b>
<b class="nc">&nbsp;                        statements.layout();</b>
<b class="nc">&nbsp;                        return true;</b>
&nbsp;                    }
&nbsp;
&nbsp;                    @Override
&nbsp;                    public void touchDragged(InputEvent event, float x, float y, int pointer){
<b class="nc">&nbsp;                        Vec2 v = localToParentCoordinates(Tmp.v1.set(x, y));</b>
&nbsp;
<b class="nc">&nbsp;                        translation.add(v.x - lastx, v.y - lasty);</b>
<b class="nc">&nbsp;                        lastx = v.x;</b>
<b class="nc">&nbsp;                        lasty = v.y;</b>
&nbsp;
<b class="nc">&nbsp;                        statements.layout();</b>
&nbsp;                    }
&nbsp;
&nbsp;                    @Override
&nbsp;                    public void touchUp(InputEvent event, float x, float y, int pointer, KeyCode button){
<b class="nc">&nbsp;                        statements.finishLayout();</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;            }).growX().height(38);</b>
&nbsp;
<b class="nc">&nbsp;            row();</b>
&nbsp;
<b class="nc">&nbsp;            table(t -&gt; {</b>
<b class="nc">&nbsp;                t.left();</b>
<b class="nc">&nbsp;                t.marginLeft(4);</b>
<b class="nc">&nbsp;                t.setColor(color);</b>
<b class="nc">&nbsp;                st.build(t);</b>
<b class="nc">&nbsp;            }).pad(4).padTop(2).left().grow();</b>
&nbsp;
<b class="nc">&nbsp;            marginBottom(7);</b>
&nbsp;        }
&nbsp;
&nbsp;        public void updateAddress(int index){
<b class="nc">&nbsp;            this.index = index;</b>
<b class="nc">&nbsp;            addressLabel.setText(index + &quot;&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        public void copy(){
<b class="nc">&nbsp;            st.saveUI();</b>
<b class="nc">&nbsp;            LStatement copy = st.copy();</b>
&nbsp;
<b class="nc">&nbsp;            if(copy instanceof JumpStatement st &amp;&amp; st.destIndex != -1){</b>
<b class="nc">&nbsp;                int index = statements.getChildren().indexOf(this);</b>
<b class="nc">&nbsp;                if(index != -1 &amp;&amp; index &lt; st.destIndex){</b>
<b class="nc">&nbsp;                    st.destIndex ++;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if(copy != null){</b>
<b class="nc">&nbsp;                StatementElem s = new StatementElem(copy);</b>
&nbsp;
<b class="nc">&nbsp;                statements.addChildAfter(StatementElem.this, s);</b>
<b class="nc">&nbsp;                statements.layout();</b>
<b class="nc">&nbsp;                copy.elem = s;</b>
<b class="nc">&nbsp;                copy.setupUI();</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void draw(){
<b class="nc">&nbsp;            float pad = 5f;</b>
<b class="nc">&nbsp;            Fill.dropShadow(x + width/2f, y + height/2f, width + pad, height + pad, 10f, 0.9f * parentAlpha);</b>
&nbsp;
<b class="nc">&nbsp;            Draw.color(0, 0, 0, 0.3f * parentAlpha);</b>
<b class="nc">&nbsp;            Fill.crect(x, y, width, height);</b>
<b class="nc">&nbsp;            Draw.reset();</b>
&nbsp;
<b class="nc">&nbsp;            super.draw();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static class JumpButton extends ImageButton{
<b class="nc">&nbsp;        Color hoverColor = Pal.place;</b>
<b class="nc">&nbsp;        Color defaultColor = Color.white;</b>
&nbsp;        Prov&lt;StatementElem&gt; to;
&nbsp;        boolean selecting;
&nbsp;        float mx, my;
&nbsp;        ClickListener listener;
&nbsp;
&nbsp;        public JumpCurve curve;
&nbsp;
&nbsp;        public JumpButton(Prov&lt;StatementElem&gt; getter, Cons&lt;StatementElem&gt; setter){
<b class="nc">&nbsp;            super(Tex.logicNode, new ImageButtonStyle(){{</b>
<b class="nc">&nbsp;                imageUpColor = Color.white;</b>
&nbsp;            }});
&nbsp;
<b class="nc">&nbsp;            to = getter;</b>
<b class="nc">&nbsp;            addListener(listener = new ClickListener());</b>
&nbsp;
<b class="nc">&nbsp;            addListener(new InputListener(){</b>
&nbsp;                @Override
&nbsp;                public boolean touchDown(InputEvent event, float x, float y, int pointer, KeyCode code){
<b class="nc">&nbsp;                    selecting = true;</b>
<b class="nc">&nbsp;                    setter.get(null);</b>
<b class="nc">&nbsp;                    mx = x;</b>
<b class="nc">&nbsp;                    my = y;</b>
<b class="nc">&nbsp;                    return true;</b>
&nbsp;                }
&nbsp;
&nbsp;                @Override
&nbsp;                public void touchDragged(InputEvent event, float x, float y, int pointer){
<b class="nc">&nbsp;                    mx = x;</b>
<b class="nc">&nbsp;                    my = y;</b>
&nbsp;                }
&nbsp;
&nbsp;                @Override
&nbsp;                public void touchUp(InputEvent event, float x, float y, int pointer, KeyCode code){
<b class="nc">&nbsp;                    localToStageCoordinates(Tmp.v1.set(x, y));</b>
<b class="nc">&nbsp;                    StatementElem elem = canvas.hovered;</b>
&nbsp;
<b class="nc">&nbsp;                    if(elem != null &amp;&amp; !isDescendantOf(elem)){</b>
<b class="nc">&nbsp;                        setter.get(elem);</b>
&nbsp;                    }else{
<b class="nc">&nbsp;                        setter.get(null);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    selecting = false;</b>
&nbsp;                }
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            update(() -&gt; {</b>
<b class="nc">&nbsp;                if(to.get() != null &amp;&amp; to.get().parent == null){</b>
<b class="nc">&nbsp;                    setter.get(null);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                setColor(listener.isOver() ? hoverColor : defaultColor);</b>
<b class="nc">&nbsp;                getStyle().imageUpColor = this.color;</b>
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            curve = new JumpCurve(this);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        protected void setScene(Scene stage){
<b class="nc">&nbsp;            super.setScene(stage);</b>
&nbsp;
<b class="nc">&nbsp;            if(stage == null){</b>
<b class="nc">&nbsp;                curve.remove();</b>
&nbsp;            }else{
<b class="nc">&nbsp;                canvas.jumps.addChild(curve);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static class JumpCurve extends Element{
&nbsp;        public JumpButton button;
&nbsp;
<b class="nc">&nbsp;        public JumpCurve(JumpButton button){</b>
<b class="nc">&nbsp;            this.button = button;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void act(float delta){
<b class="nc">&nbsp;            super.act(delta);</b>
&nbsp;
<b class="nc">&nbsp;            if(button.listener.isOver()){</b>
<b class="nc">&nbsp;                toFront();</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void draw(){
<b class="nc">&nbsp;            canvas.jumpCount ++;</b>
&nbsp;
<b class="nc">&nbsp;            if(canvas.jumpCount &gt; maxJumpsDrawn &amp;&amp; !button.selecting &amp;&amp; !button.listener.isOver()){</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Element hover = button.to.get() == null &amp;&amp; button.selecting ? canvas.hovered : button.to.get();</b>
<b class="nc">&nbsp;            boolean draw = false;</b>
<b class="nc">&nbsp;            Vec2 t = Tmp.v1, r = Tmp.v2;</b>
&nbsp;
<b class="nc">&nbsp;            Group desc = canvas.pane;</b>
&nbsp;
<b class="nc">&nbsp;            button.localToAscendantCoordinates(desc, r.set(0, 0));</b>
&nbsp;
<b class="nc">&nbsp;            if(hover != null){</b>
<b class="nc">&nbsp;                hover.localToAscendantCoordinates(desc, t.set(hover.getWidth(), hover.getHeight()/2f));</b>
&nbsp;
<b class="nc">&nbsp;                draw = true;</b>
<b class="nc">&nbsp;            }else if(button.selecting){</b>
<b class="nc">&nbsp;                t.set(r).add(button.mx, button.my);</b>
<b class="nc">&nbsp;                draw = true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            float offset = canvas.pane.getVisualScrollY() - canvas.pane.getMaxY();</b>
&nbsp;
<b class="nc">&nbsp;            t.y += offset;</b>
<b class="nc">&nbsp;            r.y += offset;</b>
&nbsp;
<b class="nc">&nbsp;            if(draw){</b>
<b class="nc">&nbsp;                drawCurve(r.x + button.getWidth()/2f, r.y + button.getHeight()/2f, t.x, t.y);</b>
&nbsp;
<b class="nc">&nbsp;                float s = button.getWidth();</b>
<b class="nc">&nbsp;                Draw.color(button.color);</b>
<b class="nc">&nbsp;                Tex.logicNode.draw(t.x + s*0.75f, t.y - s/2f, -s, s);</b>
<b class="nc">&nbsp;                Draw.reset();</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public void drawCurve(float x, float y, float x2, float y2){
<b class="nc">&nbsp;            Lines.stroke(4f, button.color);</b>
<b class="nc">&nbsp;            Draw.alpha(parentAlpha);</b>
&nbsp;
<b class="nc">&nbsp;            float dist = 100f;</b>
&nbsp;
&nbsp;            //square jumps
&nbsp;            if(false){
&nbsp;                float len = Scl.scl(Mathf.randomSeed(hashCode(), 10, 50));
&nbsp;
&nbsp;                float maxX = Math.max(x, x2) + len;
&nbsp;
&nbsp;                Lines.beginLine();
&nbsp;                Lines.linePoint(x, y);
&nbsp;                Lines.linePoint(maxX, y);
&nbsp;                Lines.linePoint(maxX, y2);
&nbsp;                Lines.linePoint(x2, y2);
&nbsp;                Lines.endLine();
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Lines.curve(</b>
&nbsp;            x, y,
&nbsp;            x + dist, y,
&nbsp;            x2 + dist, y2,
&nbsp;            x2, y2,
<b class="nc">&nbsp;            Math.max(18, (int)(Mathf.dst(x, y, x2, y2) / 6)));</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-10-10 13:22</div>
</div>
</body>
</html>
